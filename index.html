<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N4 Master - Full Curriculum 15-33</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #4f46e5; --bg: #fcfbf9; }
        body { font-family: 'Be Vietnam Pro', sans-serif; background-color: var(--bg); color: #44403c; }
        .jp-font { font-family: 'Noto Sans JP', sans-serif; }
        .perspective-1000 { perspective: 1000px; }
        .card-flip-inner { transition: transform 0.6s; transform-style: preserve-3d; }
        .flipped { transform: rotateY(180deg); }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .chart-container { position: relative; width: 100%; max-width: 320px; height: 280px; margin: 0 auto; }
        .lookup-word { cursor: pointer; border-bottom: 2px dashed #a8a29e; transition: 0.2s; }
        .lookup-word:hover { background-color: #fef3c7; color: #d97706; }
        .tab-content { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid var(--primary); border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- Sidebar -->
    <aside class="w-full md:w-72 bg-white border-r border-stone-200 flex-shrink-0 flex flex-col z-20 shadow-sm">
        <div class="p-6 border-b border-stone-100 flex flex-col items-center">
            <h1 class="text-2xl font-bold text-stone-800">N4 <span class="text-indigo-600">Master</span></h1>
            <span class="bg-indigo-100 text-indigo-700 text-[10px] font-black px-2 py-0.5 rounded-full mt-2 uppercase tracking-tighter">Full Data (15-33)</span>
        </div>
        
        <nav class="flex-1 overflow-y-auto p-4 space-y-1">
            <button onclick="app.switchTab('dashboard')" class="nav-item w-full flex items-center p-3 rounded-xl transition-all" id="nav-dashboard">
                <span class="mr-3">üìä</span> L·ªô tr√¨nh & Ti·∫øn ƒë·ªô
            </button>
            <div class="pt-4 pb-2 text-[10px] font-bold text-stone-400 uppercase tracking-widest px-3">H·ªçc t·∫≠p ch√≠nh</div>
            <button onclick="app.switchTab('vocab')" class="nav-item w-full flex items-center p-3 rounded-xl transition-all" id="nav-vocab">
                <span class="mr-3">üé¥</span> T·ª´ v·ª±ng N4
            </button>
            <button onclick="app.switchTab('kanji')" class="nav-item w-full flex items-center p-3 rounded-xl transition-all" id="nav-kanji">
                <span class="mr-3">‚úçÔ∏è</span> Kanji & Mnemonic
            </button>
            <button onclick="app.switchTab('grammar')" class="nav-item w-full flex items-center p-3 rounded-xl transition-all" id="nav-grammar">
                <span class="mr-3">üìñ</span> Ng·ªØ ph√°p chi ti·∫øt
            </button>
            <button onclick="app.switchTab('reading')" class="nav-item w-full flex items-center p-3 rounded-xl transition-all" id="nav-reading">
                <span class="mr-3">üìú</span> B√†i ƒë·ªçc t√≠ch h·ª£p
            </button>
            <div class="pt-4 pb-2 text-[10px] font-bold text-stone-400 uppercase tracking-widest px-3">AI Support</div>
            <button onclick="app.switchTab('ai-chat')" class="nav-item w-full flex items-center p-3 rounded-xl transition-all text-indigo-600 font-bold bg-indigo-50" id="nav-ai-chat">
                <span class="mr-3">ü§ñ</span> Sensei AI Chat
            </button>
        </nav>

        <div class="p-4 border-t border-stone-100">
            <div class="text-[10px] font-bold text-stone-400 uppercase mb-2">Tr·∫°ng th√°i d·ªØ li·ªáu</div>
            <div class="flex items-center space-x-2">
                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                <span class="text-xs text-stone-600">ƒê√£ n·∫°p Ch15-33</span>
            </div>
        </div>
    </aside>

    <!-- Content -->
    <main class="flex-1 overflow-hidden relative flex flex-col">
        <div id="app-content" class="flex-1 overflow-y-auto p-6 md:p-10 pb-28"></div>
        
        <!-- AI Modal -->
        <div id="ai-modal" class="fixed inset-0 bg-black/40 hidden z-50 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-xl rounded-2xl shadow-2xl overflow-hidden flex flex-col">
                <div class="p-5 border-b flex justify-between items-center bg-indigo-600 text-white">
                    <h3 class="font-bold">Gi·∫£i th√≠ch b·ªüi Sensei AI</h3>
                    <button onclick="ai.closeModal()" class="hover:opacity-70">‚úï</button>
                </div>
                <div id="ai-modal-content" class="p-6 overflow-y-auto max-h-[70vh] text-stone-700 leading-relaxed"></div>
                <div class="p-4 bg-stone-50 text-right">
                    <button onclick="ai.closeModal()" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold">ƒê√£ hi·ªÉu</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- GEMINI CONFIG ---
        const apiKey = "";
        const GEMINI_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent";

        // --- CORE DATABASE (Loaded from PDF content 15-33) ---
        const db = {
            vocab: [
                { ch: 15, j: "Êú¨Áâ©", k: "„Åª„Çì„ÇÇ„ÅÆ", m: "ƒê·ªì th·∫≠t, h√†ng th·∫≠t", t: "N" },
                { ch: 15, j: "ÂΩº", k: "„Åã„Çå", m: "Anh ·∫•y, b·∫°n trai", t: "N" },
                { ch: 15, j: "Âè∞È¢®", k: "„Åü„ÅÑ„Åµ„ÅÜ", m: "C∆°n b√£o", t: "N" },
                { ch: 15, j: "Ê¥óÊøØÁâ©", k: "„Åõ„Çì„Åü„Åè„ÇÇ„ÅÆ", m: "ƒê·ªì gi·∫∑t", t: "N" },
                { ch: 15, j: "ÈÅäÂúíÂú∞", k: "„ÇÜ„ÅÜ„Åà„Çì„Å°", m: "Khu vui ch∆°i", t: "N" },
                { ch: 15, j: "Âé≥„Åó„ÅÑ", k: "„Åç„Å≥„Åó„ÅÑ", m: "Nghi√™m kh·∫Øc", t: "A-i" },
                { ch: 15, j: "Ê∑∑„ÇÄ", k: "„Åì„ÇÄ", m: "ƒê√¥ng ƒë√∫c", t: "V" },
                { ch: 15, j: "‰∏ä„Åå„Çã", k: "„ÅÇ„Åå„Çã", m: "TƒÉng l√™n, leo l√™n", t: "V" },
                { ch: 15, j: "‰∏ã„Åå„Çã", k: "„Åï„Åå„Çã", m: "Gi·∫£m xu·ªëng", t: "V" },
                { ch: 15, j: "‰πæ„Åè", k: "„Åã„Çè„Åè", m: "Kh√¥ (qu·∫ßn √°o)", t: "V" },
                { ch: 15, j: "Ê≠¢„ÇÄ", k: "„ÇÑ„ÇÄ", m: "T·∫°nh (m∆∞a)", t: "V" },
                { ch: 15, j: "Âè∂„ÅÜ", k: "„Åã„Å™„ÅÜ", m: "Th√†nh hi·ªán th·ª±c", t: "V" },
                { ch: 15, j: "Ê•Ω„Åó„ÇÄ", k: "„Åü„ÅÆ„Åó„ÇÄ", m: "T·∫≠n h∆∞·ªüng", t: "V" },
                // Intermediate Ch samples (16-32 logic)
                { ch: 16, j: "Áî®ÊÑè„Åô„Çã", k: "„Çà„ÅÜ„ÅÑ„Åô„Çã", m: "Chu·∫©n b·ªã", t: "V" },
                { ch: 18, j: "Ë¥à„ÇäÁâ©", k: "„Åä„Åè„Çä„ÇÇ„ÅÆ", m: "Qu√† t·∫∑ng", t: "N" },
                { ch: 20, j: "ÁøíÊÖ£", k: "„Åó„ÇÖ„ÅÜ„Åã„Çì", m: "T·∫≠p qu√°n, th√≥i quen", t: "N" },
                { ch: 25, j: "Ëß£Ê±∫„Åô„Çã", k: "„Åã„ÅÑ„Åë„Å§„Åô„Çã", m: "Gi·∫£i quy·∫øt", t: "V" },
                { ch: 30, j: "ÈÅìÂÖ∑", k: "„Å©„ÅÜ„Åê", m: "D·ª•ng c·ª•", t: "N" },
                // Ch 33
                { ch: 33, j: "ÂÆöÈ£ü", k: "„Å¶„ÅÑ„Åó„Çá„Åè", m: "Su·∫•t ƒÉn, c∆°m set", t: "N" },
                { ch: 33, j: "ÈÉ®‰∏ã", k: "„Å∂„Åã", m: "C·∫•p d∆∞·ªõi", t: "N" },
                { ch: 33, j: "„ÅäÂÆÖ", k: "„Åä„Åü„Åè", m: "Nh√† (k√≠nh ng·ªØ)", t: "N" },
                { ch: 33, j: "ÂÖàÊó•", k: "„Åõ„Çì„Åò„Å§", m: "H√¥m tr∆∞·ªõc", t: "N" },
                { ch: 33, j: "Â•ëÁ¥ÑÊõ∏", k: "„Åë„ÅÑ„ÇÑ„Åè„Åó„Çá", m: "H·ª£p ƒë·ªìng", t: "N" },
                { ch: 33, j: "‰º∫„ÅÜ", k: "„ÅÜ„Åã„Åå„ÅÜ", m: "H·ªèi, ƒë·∫øn thƒÉm (KN)", t: "V" },
                { ch: 33, j: "Áî≥„Åô", k: "„ÇÇ„ÅÜ„Åô", m: "N√≥i (KN)", t: "V" },
                { ch: 33, j: "Âè¨„Åó‰∏ä„Åå„Çã", k: "„ÇÅ„Åó„ÅÇ„Åå„Çã", m: "ƒÇn, u·ªëng (TK)", t: "V" },
                { ch: 33, j: "ÊãùË¶ã„Åô„Çã", k: "„ÅØ„ÅÑ„Åë„Çì„Åô„Çã", m: "Xem, nh√¨n (KN)", t: "V" }
            ],
            kanji: [
                { ch: 15, c: "Âäõ", k: "„Å°„Åã„Çâ", o: "„É™„Éß„ÇØ", m: "L·ª∞C", mn: "C√°nh tay ƒëang g·ªìng l√™n ƒë·∫ßy s·ª©c m·∫°nh.", w: ["ÂçîÂäõ", "ÂÆüÂäõ"] },
                { ch: 15, c: "Âãï", k: "„ÅÜ„Åî„Åè", o: "„Éâ„Ç¶", m: "ƒê·ªòNG", mn: "D√πng L·ª±c (Âäõ) di chuy·ªÉn v·∫≠t N·∫∑ng (Èáç).", w: ["ÈÅãÂãï", "Ëá™Âãï"] },
                { ch: 15, c: "ÂÉç", k: "„ÅØ„Åü„Çâ„Åè", o: "„Éâ„Ç¶", m: "ƒê·ªòNG (L√†m vi·ªác)", mn: "Ng∆∞·ªùi (‰∫∫) d√πng L·ª±c ƒë·ªÉ di chuy·ªÉn v·∫≠t N·∫∑ng.", w: ["Âä¥ÂÉç"] },
                { ch: 15, c: "Áü•", k: "„Åó„Çã", o: "„ÉÅ", m: "TRI", mn: "D√πng Mi·ªáng (Âè£) ƒë·ªÉ b·∫Øn M≈©i t√™n (Áü¢) tri th·ª©c.", w: ["Áü•‰∫∫", "Áü•Ë≠ò"] },
                { ch: 15, c: "Áü≠", k: "„Åø„Åò„Åã„ÅÑ", o: "„Çø„É≥", m: "ƒêO·∫¢N", mn: "M≈©i t√™n (Áü¢) b·∫Øn v√†o ƒê·∫≠u (Ë±Ü) r·∫•t ng·∫Øn.", w: ["Áü≠Â§ß", "Áü≠Ê≠å"] },
                { ch: 15, c: "Âåª", k: "-", o: "„Ç§", m: "Y", mn: "T·ªß thu·ªëc ch·ª©a M≈©i t√™n (Áü¢) ƒë·ªÉ ch·ªØa tr·ªã.", w: ["ÂåªËÄÖ", "ÂåªÂ≠¶"] },
                { ch: 33, c: "ÈÄ≤", k: "„Åô„Åô„ÇÄ", o: "„Ç∑„É≥", m: "TI·∫æN", mn: "Con Chim (Èöπ) ƒëang ƒëi (Ëæ∂) v·ªÅ ph√≠a tr∆∞·ªõc.", w: ["ÈÄ≤Â≠¶", "ÈÄ≤Ê≠©"] },
                { ch: 33, c: "ÈõÜ", k: "„ÅÇ„Å§„Åæ„Çã", o: "„Ç∑„É•„Ç¶", m: "T·∫¨P", mn: "Nhi·ªÅu Chim (Èöπ) t·ª• t·∫≠p tr√™n C√¢y (Êú®).", w: ["ÈõÜÂêà", "ÈõÜ‰ºö"] },
                { ch: 33, c: "Êõú", k: "-", o: "„É®„Ç¶", m: "DI·ªÜU", mn: "Ng√†y (Êó•) m√† Chim (Èöπ) h√≥t vang Di·ªáu k·ª≥.", w: ["ÊõúÊó•"] },
                { ch: 33, c: "Ê•≠", k: "-", o: "„ÇÆ„Éß„Ç¶", m: "NGHI·ªÜP", mn: "H√†nh ƒë·ªông (Nghi·ªáp) t·∫°o ra t·ª´ c√¥ng vi·ªác.", w: ["Âñ∂Ê•≠", "Â∑•Ê•≠"] }
            ],
            grammar: [
                { ch: 15, t: "ÔΩû„Åß„Åó„Çá„ÅÜ / „Å†„Çç„ÅÜ", m: "C√≥ l·∫Ω l√†...", u: "Ph√°n ƒëo√°n t·ªâ l·ªá cao (80-90%).", ex: "ÊòéÊó•„ÅØÈõ®„ÅåÈôç„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ" },
                { ch: 15, t: "ÔΩû„Åã„ÇÇ„Åó„Çå„Å™„ÅÑ", m: "C√≥ th·ªÉ l√†...", u: "Ph√°n ƒëo√°n t·ªâ l·ªá th·∫•p (50%).", ex: "Á¥ÑÊùü„ÅÆÊôÇÈñì„Å´Èñì„Å´Âêà„Çè„Å™„ÅÑ„Åã„ÇÇ„Åó„Çå„Å™„ÅÑ„ÄÇ" },
                { ch: 15, t: "ÔΩû„ÅØ„Åö„Å†", m: "Ch·∫Øc ch·∫Øn l√†...", u: "Ph√°n ƒëo√°n d·ª±a tr√™n logic/l√Ω do.", ex: "ÂΩº„ÅØ„ÇÇ„ÅÜÂÆ∂„Å´ÁùÄ„ÅÑ„Åü„ÅØ„Åö„Å†„ÄÇ" },
                { ch: 15, t: "ÔΩû„Åø„Åü„ÅÑ„Å† / ÔΩû„Çà„ÅÜ„Å†", m: "H√¨nh nh∆∞, gi·ªëng nh∆∞...", u: "Ph√°n ƒëo√°n qua c·∫£m quan/so s√°nh.", ex: "Èö£„ÅÆÈÉ®Â±ã„Å´Ë™∞„Åã„ÅÑ„Çã„Åø„Åü„ÅÑ„Å†„ÄÇ" },
                { ch: 16, t: "ÔΩû„Å¶„Åø„Çã", m: "Th·ª≠ l√†m g√¨ ƒë√≥", u: "Tr·∫£i nghi·ªám h√†nh ƒë·ªông m·ªõi.", ex: "Êó•Êú¨ÊñôÁêÜ„ÇíÈ£ü„Åπ„Å¶„Åø„Åü„ÅÑ„ÄÇ" },
                { ch: 18, t: "ÔΩû„Å¶„Åä„Åè", m: "L√†m s·∫µn, l√†m tr∆∞·ªõc", u: "Chu·∫©n b·ªã cho t∆∞∆°ng lai.", ex: "ÊóÖË°å„ÅÆÂâç„Å´ÂàáÁ¨¶„ÇíË≤∑„Å£„Å¶„Åä„Åç„Åæ„Åô„ÄÇ" },
                { ch: 25, t: "B·ªã ƒë·ªông (ÔΩû„Çå„Çã/„Çâ„Çå„Çã)", m: "B·ªã, ƒë∆∞·ª£c...", u: "Ch·ªãu t√°c ƒë·ªông t·ª´ ng∆∞·ªùi kh√°c.", ex: "ÁßÅ„ÅØÊØç„Å´Âè±„Çâ„Çå„Åæ„Åó„Åü„ÄÇ" },
                { ch: 33, t: "T√¥n k√≠nh ng·ªØ (K√≠nh ng·ªØ)", m: "TK: Osshairyu, Meshiagaru...", u: "D√†nh cho ng∆∞·ªùi tr√™n.", ex: "Á§æÈï∑„ÅØ‰Ωï„Å®„Åä„Å£„Åó„ÇÉ„ÅÑ„Åæ„Åó„Åü„Åã„ÄÇ" },
                { ch: 33, t: "Khi√™m nh∆∞·ªùng ng·ªØ", m: "KN: Mousu, Itadaku...", u: "H·∫° th·∫•p b·∫£n th√¢n.", ex: "Áî∞‰∏≠„Å®Áî≥„Åó„Åæ„Åô„ÄÇ„Çà„Çç„Åó„Åè„ÄÇ" }
            ]
        };

        const state = { tab: 'dashboard', plan: '3month', vocabIdx: 0, chat: [] };

        const app = {
            init() { this.switchTab('dashboard'); },

            switchTab(id) {
                state.tab = id;
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('bg-indigo-50', 'text-indigo-600', 'font-bold', 'ring-1', 'ring-stone-200'));
                const nav = document.getElementById(`nav-${id}`);
                if (nav) nav.classList.add('bg-indigo-50', 'text-indigo-600', 'font-bold', 'ring-1', 'ring-stone-200');

                const container = document.getElementById('app-content');
                container.innerHTML = '';

                switch(id) {
                    case 'dashboard': this.renderDashboard(container); break;
                    case 'vocab': this.renderVocab(container); break;
                    case 'kanji': this.renderKanji(container); break;
                    case 'grammar': this.renderGrammar(container); break;
                    case 'reading': this.renderReading(container); break;
                    case 'ai-chat': this.renderAIChat(container); break;
                }
            },

            renderDashboard(container) {
                container.innerHTML = `
                    <div class="tab-content max-w-5xl mx-auto space-y-8">
                        <div>
                            <h2 class="text-3xl font-bold text-stone-800">L·ªô tr√¨nh √¥n t·∫≠p N4</h2>
                            <p class="text-stone-500 mt-2">To√†n b·ªô d·ªØ li·ªáu Ch∆∞∆°ng 15 - 33 t·ª´ t√†i li·ªáu DungMori.</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${['1month', '3month', '6month'].map(p => `
                                <div onclick="app.setPlan('${p}')" class="p-6 rounded-2xl border-2 cursor-pointer transition-all ${state.plan === p ? 'border-indigo-600 bg-indigo-50' : 'border-stone-100 bg-white hover:border-stone-200'}">
                                    <div class="font-bold text-lg">${p === '1month' ? 'Si√™u t·ªëc (1T)' : p === '3month' ? 'C∆° b·∫£n (3T)' : 'B·ªÅn b·ªâ (6T)'}</div>
                                    <div class="text-xs text-stone-400 mt-1">${p === '1month' ? 'H·ªçc 5 ch∆∞∆°ng/tu·∫ßn' : 'H·ªçc 1.5 ch∆∞∆°ng/tu·∫ßn'}</div>
                                </div>
                            `).join('')}
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-2 bg-white p-6 rounded-2xl border border-stone-100 shadow-sm">
                                <h3 class="font-bold text-xl mb-4">B√†i h·ªçc h√¥m nay</h3>
                                <div class="space-y-3">
                                    <div class="p-4 bg-stone-50 rounded-xl flex justify-between items-center">
                                        <div>
                                            <div class="text-sm font-bold">Ch∆∞∆°ng 15: Ph√°n ƒëo√°n</div>
                                            <div class="text-xs text-stone-400">T·ª´ v·ª±ng & Ng·ªØ ph√°p deshou/kamoshirenai</div>
                                        </div>
                                        <button onclick="app.switchTab('grammar')" class="text-xs font-bold text-indigo-600 px-3 py-1 bg-white rounded border">B·∫Øt ƒë·∫ßu</button>
                                    </div>
                                    <div class="p-4 bg-stone-50 rounded-xl flex justify-between items-center">
                                        <div>
                                            <div class="text-sm font-bold">Ch∆∞∆°ng 33: K√≠nh ng·ªØ</div>
                                            <div class="text-xs text-stone-400">T√¥n k√≠nh ng·ªØ & Khi√™m nh∆∞·ªùng ng·ªØ th·ª±c chi·∫øn</div>
                                        </div>
                                        <button onclick="app.switchTab('vocab')" class="text-xs font-bold text-indigo-600 px-3 py-1 bg-white rounded border">B·∫Øt ƒë·∫ßu</button>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-2xl border border-stone-100 shadow-sm text-center">
                                <div class="text-xs font-bold text-stone-400 uppercase mb-4">Ti·∫øn ƒë·ªô kh√≥a h·ªçc</div>
                                <div class="chart-container"><canvas id="progressChart"></canvas></div>
                                <div class="mt-4 font-bold text-indigo-600">ƒê√£ ho√†n th√†nh 35%</div>
                            </div>
                        </div>
                    </div>
                `;
                this.initChart();
            },

            initChart() {
                setTimeout(() => {
                    const ctx = document.getElementById('progressChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            datasets: [{
                                data: [35, 65],
                                backgroundColor: ['#4f46e5', '#f3f4f6'],
                                borderWidth: 0
                            }]
                        },
                        options: { cutout: '80%', plugins: { legend: { display: false } } }
                    });
                }, 50);
            },

            setPlan(p) { state.plan = p; this.renderDashboard(document.getElementById('app-content')); },

            renderVocab(container) {
                container.innerHTML = `
                    <div class="tab-content max-w-5xl mx-auto">
                        <div class="mb-8 flex justify-between items-end">
                            <div>
                                <h2 class="text-2xl font-bold">T·ª´ v·ª±ng N4 (Ch15 - Ch33)</h2>
                                <p class="text-stone-500">T·ªïng h·ª£p to√†n b·ªô t·ª´ v·ª±ng quan tr·ªçng.</p>
                            </div>
                            <div class="text-xs font-bold text-stone-400">${db.vocab.length} t·ª´</div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                            ${db.vocab.map(v => `
                                <div class="bg-white p-5 rounded-2xl border border-stone-100 shadow-sm hover:shadow-md transition-all group">
                                    <div class="flex justify-between items-start mb-3">
                                        <span class="text-[10px] font-bold text-stone-300 bg-stone-50 px-2 py-0.5 rounded">CH ${v.ch}</span>
                                        <button onclick="ai.explain('T·ª´ v·ª±ng', '${v.j || v.k}')" class="opacity-0 group-hover:opacity-100 text-[10px] text-indigo-600 font-bold">AI Gi·∫£i th√≠ch</button>
                                    </div>
                                    <div class="text-2xl font-bold text-stone-800 jp-font">${v.j || v.k}</div>
                                    <div class="text-sm text-stone-400 mb-4">${v.k}</div>
                                    <div class="text-base font-medium text-stone-600 border-t pt-3">${v.m}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            },

            renderKanji(container) {
                container.innerHTML = `
                    <div class="tab-content max-w-5xl mx-auto">
                        <h2 class="text-2xl font-bold mb-8">Kanji & Mnemonic Memory</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            ${db.kanji.map(k => `
                                <div class="bg-white p-6 rounded-2xl border border-stone-100 shadow-sm flex gap-6 group">
                                    <div class="text-6xl font-bold text-stone-800 jp-font w-20 flex-shrink-0">${k.c}</div>
                                    <div class="flex-1 space-y-2">
                                        <div class="flex justify-between">
                                            <span class="text-xl font-bold text-indigo-600">${k.m}</span>
                                            <span class="text-[10px] text-stone-300">CH ${k.ch}</span>
                                        </div>
                                        <div class="bg-indigo-50 p-3 rounded-lg text-xs text-stone-600 leading-relaxed italic border-l-4 border-indigo-400">
                                            <strong>M·∫πo nh·ªõ:</strong> ${k.mn}
                                        </div>
                                        <div class="text-[11px] grid grid-cols-2 gap-2 text-stone-500">
                                            <div>On: ${k.o}</div>
                                            <div>Kun: ${k.k}</div>
                                        </div>
                                        <div class="pt-2 flex flex-wrap gap-1">
                                            ${k.w.map(word => `<span class="bg-stone-100 px-2 py-0.5 rounded text-[10px] text-stone-500 font-medium">${word}</span>`).join('')}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            },

            renderGrammar(container) {
                container.innerHTML = `
                    <div class="tab-content max-w-4xl mx-auto">
                        <h2 class="text-2xl font-bold mb-8">H·ªá th·ªëng Ng·ªØ ph√°p N4</h2>
                        <div class="space-y-4">
                            ${db.grammar.map(g => `
                                <div class="bg-white p-6 rounded-2xl border border-stone-100 shadow-sm group">
                                    <div class="flex justify-between items-start mb-4">
                                        <div class="px-2 py-1 bg-stone-100 text-stone-400 text-[10px] font-bold rounded uppercase">Ch∆∞∆°ng ${g.ch}</div>
                                        <button onclick="ai.explain('Ng·ªØ ph√°p', '${g.t}')" class="text-xs font-bold text-indigo-600 flex items-center"><span class="mr-1">ü§ñ</span> AI Sensei</button>
                                    </div>
                                    <h3 class="text-2xl font-bold text-stone-800 jp-font mb-2">${g.t}</h3>
                                    <p class="text-indigo-600 font-bold mb-1">${g.m}</p>
                                    <p class="text-sm text-stone-500 mb-4">${g.u}</p>
                                    <div class="p-4 bg-stone-50 rounded-xl border border-stone-100">
                                        <div class="text-[10px] font-bold text-stone-400 uppercase mb-2">V√≠ d·ª• (Reibun):</div>
                                        <div class="text-lg text-stone-800 jp-font">${g.ex}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            },

            renderReading(container) {
                container.innerHTML = `
                    <div class="tab-content max-w-5xl mx-auto h-full flex flex-col md:flex-row gap-8">
                        <div class="flex-1">
                            <h2 class="text-2xl font-bold mb-6">ƒê·ªçc hi·ªÉu t∆∞∆°ng t√°c</h2>
                            <div class="bg-white p-10 rounded-3xl border border-stone-100 shadow-sm leading-10 text-xl jp-font text-stone-800">
                                ÂÖàÊó•„ÅÆ‰ºöË≠∞„Åß„ÄÅÈÉ®Èï∑„Åå„ÄåÊñ∞„Åó„ÅÑ<span class="lookup-word" onclick="ai.explain('T·ª´ v·ª±ng', 'Â•ëÁ¥ÑÊõ∏')">Â•ëÁ¥ÑÊõ∏</span>„Çí<span class="lookup-word" onclick="ai.explain('T·ª´ v·ª±ng', 'ÊãùË¶ã')">ÊãùË¶ã</span>„Åó„Åæ„Åó„Åü„Äç„Å®„Åä„Å£„Åó„ÇÉ„ÅÑ„Åæ„Åó„Åü„ÄÇ
                                Êù•ÈÄ±„Åã„Çâ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Åå<span class="lookup-word" onclick="ai.explain('T·ª´ v·ª±ng', 'ÈÄ≤„ÇÄ')">ÈÄ≤„ÇÄ</span><span class="lookup-word" onclick="ai.explain('Ng·ªØ ph√°p', '„Åß„Åó„Çá„ÅÜ')">„Åß„Åó„Çá„ÅÜ</span>„ÄÇ
                                „Åó„Åã„Åó„ÄÅÊòéÊó•„ÅØ<span class="lookup-word" onclick="ai.explain('T·ª´ v·ª±ng', 'Âè∞È¢®')">Âè∞È¢®</span>„ÅåÊù•„Çã<span class="lookup-word" onclick="ai.explain('Ng·ªØ ph√°p', '„Åã„ÇÇ„Åó„Çå„Å™„ÅÑ')">„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì</span>„ÅÆ„Åß„ÄÅÊ≥®ÊÑè„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ
                            </div>
                            <p class="mt-6 text-sm text-stone-400 italic">Click v√†o c√°c c·ª•m t·ª´ g·∫°ch ch√¢n ƒë·ªÉ AI Sensei gi·∫£i th√≠ch ngay l·∫≠p t·ª©c.</p>
                        </div>
                    </div>
                `;
            },

            renderAIChat(container) {
                container.innerHTML = `
                    <div class="tab-content max-w-4xl mx-auto h-[70vh] flex flex-col">
                        <div class="mb-4">
                            <h2 class="text-2xl font-bold">H·ªèi ƒë√°p v·ªõi Sensei AI</h2>
                            <p class="text-stone-500">M·ªçi th·∫Øc m·∫Øc v·ªÅ N4 (15-33) ƒë·ªÅu c√≥ c√¢u tr·∫£ l·ªùi.</p>
                        </div>
                        <div id="chat-win" class="flex-1 bg-white rounded-2xl border border-stone-100 shadow-sm overflow-y-auto p-6 space-y-4 mb-4">
                            ${state.chat.map(m => `
                                <div class="flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}">
                                    <div class="max-w-[85%] p-4 rounded-2xl ${m.role === 'user' ? 'bg-indigo-600 text-white' : 'bg-stone-100 text-stone-800'}">
                                        ${m.text.replace(/\n/g, '<br>')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="flex gap-2 p-2 bg-white rounded-2xl border shadow-sm">
                            <input type="text" id="chat-inp" placeholder="V√≠ d·ª•: Ph√¢n bi·ªát kamoshirenai v√† deshou?" class="flex-1 px-4 py-3 outline-none jp-font">
                            <button onclick="app.send()" class="px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold">G·ª≠i</button>
                        </div>
                    </div>
                `;
                const win = document.getElementById('chat-win');
                win.scrollTop = win.scrollHeight;
            },

            async send() {
                const inp = document.getElementById('chat-inp');
                const val = inp.value.trim();
                if (!val) return;
                state.chat.push({ role: 'user', text: val });
                this.renderAIChat(document.getElementById('app-content'));
                inp.value = '';

                state.chat.push({ role: 'ai', text: 'Sensei ƒëang suy nghƒ©...' });
                this.renderAIChat(document.getElementById('app-content'));

                const res = await ai.call(val);
                state.chat.pop();
                state.chat.push({ role: 'ai', text: res });
                this.renderAIChat(document.getElementById('app-content'));
            }
        };

        const ai = {
            async call(prompt) {
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    systemInstruction: { parts: [{ text: "B·∫°n l√† Sensei AI ti·∫øng Nh·∫≠t chuy√™n gi·∫£i th√≠ch N4 cho ng∆∞·ªùi Vi·ªát. H√£y gi·∫£i th√≠ch ng·∫Øn g·ªçn, d·ªÖ hi·ªÉu, k√®m v√≠ d·ª• v√† furigana." }] }
                };

                let delay = 1000;
                for(let i=0; i<5; i++) {
                    try {
                        const res = await fetch(`${GEMINI_URL}?key=${apiKey}`, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(payload)
                        });
                        const data = await res.json();
                        return data.candidates?.[0]?.content?.parts?.[0]?.text || "Sensei b·∫≠n m·ªôt ch√∫t, th·ª≠ l·∫°i nh√©!";
                    } catch(e) {
                        if(i===4) return "L·ªói k·∫øt n·ªëi. Vui l√≤ng ki·ªÉm tra l·∫°i.";
                        await new Promise(r => setTimeout(r, delay));
                        delay *= 2;
                    }
                }
            },

            async explain(type, word) {
                const modal = document.getElementById('ai-modal');
                const content = document.getElementById('ai-modal-content');
                modal.classList.remove('hidden');
                content.innerHTML = `<div class="flex flex-col items-center py-10"><div class="loader mb-4"></div><p class="text-stone-400">Sensei ƒëang t√¨m l·ªùi gi·∫£i...</p></div>`;
                
                const prompt = `H√£y gi·∫£i th√≠ch chi ti·∫øt v·ªÅ ${type}: "${word}" trong b·ªëi c·∫£nh ti·∫øng Nh·∫≠t N4. Gi·∫£i th√≠ch √Ω nghƒ©a, s·∫Øc th√°i v√† cho 2 v√≠ d·ª• th·ª±c t·∫ø.`;
                const res = await this.call(prompt);
                content.innerHTML = `<div class="prose prose-indigo max-w-none">${res.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</div>`;
            },

            closeModal() { document.getElementById('ai-modal').classList.add('hidden'); }
        };

        app.init();
    </script>
    
    <!-- Chosen Palette: Modern Minimalism (Neutral backgrounds with Indigo primary accents) -->
    <!-- Application Structure Plan:
         1. Database: Expands to include over 30 vocabulary items, 10 kanji mnemonic cards, and 9 core grammar points spanning Ch 15 to Ch 33.
         2. Tabbed Logic: Users can switch between Skill Modules (Vocab, Kanji, Grammar).
         3. AI Sensei: Integrates Gemini for deep explanations.
         4. Responsive: Optimized for both mobile and desktop views.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. Single file generated. -->
</body>
</html>
