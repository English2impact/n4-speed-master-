<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N4 NAT-TEST Master | Luyá»‡n thi tiáº¿ng Nháº­t</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Chosen Palette: Sakura & Matcha (Soft Pink, Calming Green, Dark Grey text) -->
    <!-- Application Structure Plan: 
         1. Dashboard (Lá»™ trÃ¬nh): Central hub. User selects duration -> App calculates daily tasks. Charts show progress.
         2. Vocabulary (Tá»« vá»±ng): Flashcard UI for learning, Quiz UI for testing. 
         3. Kanji (HÃ¡n tá»±): Grid view for overview, SRS-style detailed modal for deep learning.
         4. Grammar (Ngá»¯ phÃ¡p): List view with expandable details (Accordion) for clear explanation/example separation.
         5. Reading (Äá»c hiá»ƒu): Text container with interactive word lookup functionality.
         
         Navigation: Bottom tab bar for mobile feel/ease of access, top header for global stats.
    -->
    
    <style>
        body { font-family: 'Nunito', 'Noto Sans JP', sans-serif; background-color: #fdf2f8; /* pink-50 */ }
        .kanji-font { font-family: 'Noto Sans JP', sans-serif; }
        .card-flip { perspective: 1000px; }
        .card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .card-back { transform: rotateY(180deg); background-color: #ecfdf5; /* green-50 */ }
        .flipped .card-inner { transform: rotateY(180deg); }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #fbcfe8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #f472b6; }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 250px;
            margin: 0 auto;
        }
        
        .highlight-word {
            cursor: pointer;
            border-bottom: 2px dashed #db2777; /* pink-600 */
            transition: background-color 0.2s;
        }
        .highlight-word:hover { background-color: #fce7f3; }

        /* Hide sections by default */
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .nav-item.active { color: #be185d; /* pink-700 */ border-bottom: 2px solid #be185d; }
    </style>
</head>
<body class="text-gray-800 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white shadow-sm z-10 p-4 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="bg-pink-500 text-white p-2 rounded-lg font-bold text-xl">N4</div>
            <div>
                <h1 class="font-bold text-lg leading-tight text-pink-700">N4 Master</h1>
                <p class="text-xs text-gray-500">Luyá»‡n thi NAT-TEST</p>
            </div>
        </div>
        <div class="flex items-center gap-3">
            <div class="text-right hidden sm:block">
                <p class="text-xs font-semibold text-gray-600">Tiáº¿n Ä‘á»™ tá»•ng</p>
                <p class="text-sm font-bold text-green-600" id="global-progress-text">0%</p>
            </div>
            <div class="w-10 h-10 relative">
                 <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                    <path class="text-gray-200" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="4" />
                    <path id="global-progress-ring" class="text-pink-500 transition-all duration-1000" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="4" />
                </svg>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto bg-gray-50 relative pb-20 sm:pb-4">
        
        <!-- 1. DASHBOARD / Lá»˜ TRÃŒNH -->
        <section id="tab-plan" class="tab-content active p-4 max-w-4xl mx-auto space-y-6">
            <div class="bg-white rounded-2xl shadow-sm p-6 border-l-4 border-pink-400">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">ğŸ‘‹ Konnichiwa!</h2>
                <p class="text-gray-600 mb-4">ChÃ o má»«ng báº¡n trá»Ÿ láº¡i. HÃ£y chá»n lá»™ trÃ¬nh há»c táº­p Ä‘á»ƒ chÃºng tÃ´i phÃ¢n bá»• ná»™i dung cho báº¡n.</p>
                
                <div class="flex flex-wrap gap-4 items-center bg-pink-50 p-4 rounded-xl">
                    <label class="font-semibold text-gray-700">Má»¥c tiÃªu:</label>
                    <select id="plan-duration" class="bg-white border border-pink-200 text-gray-700 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-pink-400">
                        <option value="1">1 ThÃ¡ng (Cáº¥p tá»‘c)</option>
                        <option value="3" selected>3 ThÃ¡ng (TiÃªu chuáº©n)</option>
                        <option value="6">6 ThÃ¡ng (Thong tháº£)</option>
                    </select>
                    <button onclick="app.generatePlan()" class="bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded-lg font-bold shadow transition">Láº­p Káº¿ Hoáº¡ch</button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Today's Tasks -->
                <div class="bg-white rounded-2xl shadow-sm p-5">
                    <h3 class="font-bold text-lg text-gray-800 mb-4 flex items-center gap-2">
                        <span class="text-2xl">ğŸ“…</span> Nhiá»‡m vá»¥ hÃ´m nay
                    </h3>
                    <ul id="daily-tasks" class="space-y-3">
                        <!-- Dynamic Tasks -->
                        <li class="text-gray-500 italic">Vui lÃ²ng láº­p káº¿ hoáº¡ch Ä‘á»ƒ xem nhiá»‡m vá»¥.</li>
                    </ul>
                </div>

                <!-- Stats Chart -->
                <div class="bg-white rounded-2xl shadow-sm p-5 flex flex-col items-center">
                    <h3 class="font-bold text-lg text-gray-800 mb-2">Biá»ƒu Ä‘á»“ nÄƒng lá»±c</h3>
                    <div class="chart-container">
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. VOCABULARY / Tá»ª Vá»°NG -->
        <section id="tab-vocab" class="tab-content p-4 max-w-3xl mx-auto h-full flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-800">Tá»« Vá»±ng (ChÆ°Æ¡ng 15)</h2>
                <div class="flex bg-gray-200 rounded-lg p-1">
                    <button onclick="app.setVocabMode('flashcard')" id="btn-flashcard" class="px-4 py-1 rounded-md text-sm font-bold bg-white text-pink-600 shadow transition">Há»c</button>
                    <button onclick="app.setVocabMode('quiz')" id="btn-quiz" class="px-4 py-1 rounded-md text-sm font-bold text-gray-500 hover:bg-gray-100 transition">Kiá»ƒm tra</button>
                </div>
            </div>

            <!-- Flashcard View -->
            <div id="vocab-flashcard-view" class="flex-1 flex flex-col items-center justify-center space-y-6 py-4">
                <div class="w-full max-w-md h-80 card-flip cursor-pointer group" onclick="this.classList.toggle('flipped')">
                    <div class="card-inner bg-white rounded-2xl shadow-xl border border-gray-100">
                        <!-- Front -->
                        <div class="card-front bg-white">
                            <span class="text-xs font-bold text-gray-400 absolute top-4 left-4">WORD</span>
                            <div id="fc-word" class="text-5xl font-bold text-gray-800 mb-2 kanji-font"></div>
                            <div id="fc-reading" class="text-xl text-pink-500"></div>
                            <p class="absolute bottom-4 text-gray-400 text-xs animate-bounce">Cháº¡m Ä‘á»ƒ láº­t</p>
                        </div>
                        <!-- Back -->
                        <div class="card-back bg-green-50">
                            <span class="text-xs font-bold text-green-600 absolute top-4 left-4">MEANING</span>
                            <div id="fc-meaning" class="text-2xl font-bold text-gray-800 px-6"></div>
                            <div class="mt-4 flex gap-2">
                                <span id="fc-type" class="px-2 py-1 bg-green-200 text-green-800 text-xs rounded-full"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex gap-4">
                    <button onclick="app.prevCard()" class="w-12 h-12 rounded-full bg-white shadow hover:bg-gray-50 flex items-center justify-center text-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                    </button>
                    <div class="flex items-center text-gray-500 font-mono">
                        <span id="fc-current">1</span> / <span id="fc-total">--</span>
                    </div>
                    <button onclick="app.nextCard()" class="w-12 h-12 rounded-full bg-pink-500 shadow hover:bg-pink-600 flex items-center justify-center text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                    </button>
                </div>
            </div>

            <!-- Quiz View -->
            <div id="vocab-quiz-view" class="hidden flex-1 flex flex-col items-center justify-center py-4">
                <div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-lg text-center">
                    <div class="mb-6">
                        <span class="text-xs uppercase tracking-widest text-gray-400">Chá»n nghÄ©a Ä‘Ãºng</span>
                        <h3 id="quiz-question" class="text-4xl font-bold text-gray-800 mt-2 kanji-font"></h3>
                    </div>
                    <div id="quiz-options" class="grid grid-cols-1 gap-3">
                        <!-- Options injected here -->
                    </div>
                    <div id="quiz-feedback" class="mt-4 h-6 text-sm font-bold"></div>
                </div>
            </div>
        </section>

        <!-- 3. KANJI / HÃN Tá»° -->
        <section id="tab-kanji" class="tab-content p-4 max-w-4xl mx-auto">
            <div class="mb-6 bg-white p-6 rounded-2xl shadow-sm border-b-4 border-indigo-500">
                <h2 class="text-2xl font-bold text-gray-800">Kho Kanji (Space Memory)</h2>
                <p class="text-gray-600 text-sm mt-1">Ã”n táº­p HÃ¡n tá»± theo phÆ°Æ¡ng phÃ¡p láº·p láº¡i ngáº¯t quÃ£ng. ÄÃ¡nh giÃ¡ má»©c Ä‘á»™ ghi nhá»› Ä‘á»ƒ há»‡ thá»‘ng sáº¯p xáº¿p lá»‹ch Ã´n.</p>
            </div>

            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4" id="kanji-grid">
                <!-- Kanji Items -->
            </div>
        </section>

        <!-- 4. GRAMMAR / NGá»® PHÃP -->
        <section id="tab-grammar" class="tab-content p-4 max-w-3xl mx-auto">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 pl-2 border-l-4 border-yellow-400">Ngá»¯ PhÃ¡p N4</h2>
            <div id="grammar-list" class="space-y-4">
                <!-- Grammar Items -->
            </div>
        </section>

        <!-- 5. READING / Äá»ŒC HIá»‚U -->
        <section id="tab-reading" class="tab-content p-4 max-w-3xl mx-auto">
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <div class="bg-teal-600 p-4 text-white">
                    <h2 class="text-xl font-bold">BÃ i Äá»c: Cuá»™c sá»‘ng hÃ ng ngÃ y</h2>
                    <p class="text-teal-100 text-sm">Cháº¡m vÃ o tá»« Ä‘Æ°á»£c gáº¡ch chÃ¢n Ä‘á»ƒ tra nghÄ©a nhanh.</p>
                </div>
                <div class="p-6 leading-loose text-lg text-gray-800 kanji-font" id="reading-content">
                    <!-- Reading Text injected via JS -->
                </div>
            </div>

            <!-- Lookup Modal/Tooltip -->
            <div id="lookup-modal" class="fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white p-4 rounded-xl shadow-2xl w-11/12 max-w-sm hidden z-50 transition-all">
                <div class="flex justify-between items-start">
                    <div>
                        <h4 id="lookup-word" class="text-2xl font-bold text-yellow-400"></h4>
                        <p id="lookup-reading" class="text-sm text-gray-300"></p>
                    </div>
                    <button onclick="document.getElementById('lookup-modal').classList.add('hidden')" class="text-gray-400 hover:text-white">&times;</button>
                </div>
                <div class="mt-2 pt-2 border-t border-gray-700">
                    <p id="lookup-mean" class="font-medium"></p>
                </div>
            </div>
        </section>

        <!-- Kanji Detail Modal -->
        <div id="kanji-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden transform transition-all">
                <div class="bg-indigo-600 p-4 text-white flex justify-between items-center">
                    <h3 class="text-lg font-bold">Chi tiáº¿t HÃ¡n Tá»±</h3>
                    <button onclick="app.closeKanjiModal()" class="text-white hover:text-indigo-200 text-2xl">&times;</button>
                </div>
                <div class="p-6 text-center">
                    <div id="k-modal-char" class="text-8xl font-bold text-gray-800 kanji-font mb-2"></div>
                    <div id="k-modal-mean" class="text-xl font-bold text-indigo-600 uppercase tracking-wide mb-6"></div>
                    
                    <div class="grid grid-cols-2 gap-4 text-left text-sm bg-gray-50 p-4 rounded-lg">
                        <div>
                            <span class="block text-gray-400 text-xs">ONYOMI (Ã‚m On)</span>
                            <span id="k-modal-on" class="font-bold text-gray-700"></span>
                        </div>
                        <div>
                            <span class="block text-gray-400 text-xs">KUNYOMI (Ã‚m Kun)</span>
                            <span id="k-modal-kun" class="font-bold text-gray-700"></span>
                        </div>
                    </div>
                    
                    <div class="mt-4 text-left">
                        <span class="block text-gray-400 text-xs mb-1">VÃ­ dá»¥:</span>
                        <ul id="k-modal-examples" class="text-sm text-gray-700 space-y-1"></ul>
                    </div>
                </div>
                <div class="p-4 bg-gray-100 flex justify-around">
                    <button onclick="app.rateKanji('hard')" class="bg-red-100 text-red-600 px-4 py-2 rounded-lg font-bold hover:bg-red-200">KhÃ³</button>
                    <button onclick="app.rateKanji('good')" class="bg-blue-100 text-blue-600 px-4 py-2 rounded-lg font-bold hover:bg-blue-200">ÄÆ°á»£c</button>
                    <button onclick="app.rateKanji('easy')" class="bg-green-100 text-green-600 px-4 py-2 rounded-lg font-bold hover:bg-green-200">Dá»…</button>
                </div>
            </div>
        </div>

    </main>

    <!-- Navigation Bar (Bottom) -->
    <nav class="bg-white border-t border-gray-200 flex justify-around py-2 sm:py-3 z-20 sticky bottom-0 w-full">
        <button onclick="app.switchTab('plan')" class="nav-item active flex flex-col items-center p-2 text-gray-500 hover:text-pink-600 transition w-1/5">
            <span class="text-xl mb-1">ğŸ“…</span>
            <span class="text-[10px] sm:text-xs font-medium">Lá»™ trÃ¬nh</span>
        </button>
        <button onclick="app.switchTab('vocab')" class="nav-item flex flex-col items-center p-2 text-gray-500 hover:text-pink-600 transition w-1/5">
            <span class="text-xl mb-1">ã‚</span>
            <span class="text-[10px] sm:text-xs font-medium">Tá»« vá»±ng</span>
        </button>
        <button onclick="app.switchTab('kanji')" class="nav-item flex flex-col items-center p-2 text-gray-500 hover:text-pink-600 transition w-1/5">
            <span class="text-xl mb-1">æ¼¢</span>
            <span class="text-[10px] sm:text-xs font-medium">Kanji</span>
        </button>
        <button onclick="app.switchTab('grammar')" class="nav-item flex flex-col items-center p-2 text-gray-500 hover:text-pink-600 transition w-1/5">
            <span class="text-xl mb-1">æ–‡</span>
            <span class="text-[10px] sm:text-xs font-medium">Ngá»¯ phÃ¡p</span>
        </button>
        <button onclick="app.switchTab('reading')" class="nav-item flex flex-col items-center p-2 text-gray-500 hover:text-pink-600 transition w-1/5">
            <span class="text-xl mb-1">èª­</span>
            <span class="text-[10px] sm:text-xs font-medium">Äá»c</span>
        </button>
    </nav>

    <script>
        // --- DATA SOURCE (Extracted from provided PDFs) ---
        // Visualization & Content Choices:
        // 1. Vocab: Flashcards for rote memorization (Source: Chapter 15 Vocab).
        // 2. Kanji: Grid for visual scanning, Modal for detail. 'Hard/Good/Easy' buttons simulate SRS feedback loop (Source: Chapter 15 & 33).
        // 3. Grammar: Accordion for space saving. N4 grammar points often have multiple nuances, so clear separation is key (Source: Chapter 15 Grammar).
        
        const database = {
            vocab: [
                { id: 1, word: 'æœ¬ç‰©', reading: 'ã»ã‚“ã‚‚ã®', mean: 'hÃ ng tháº­t, Ä‘á»“ tháº­t', type: 'N' },
                { id: 2, word: 'å½¼', reading: 'ã‹ã‚Œ', mean: 'anh áº¥y, báº¡n trai', type: 'N' },
                { id: 3, word: 'å°é¢¨', reading: 'ãŸã„ãµã†', mean: 'cÆ¡n bÃ£o', type: 'N' },
                { id: 4, word: 'æ´—æ¿¯ç‰©', reading: 'ã›ã‚“ãŸãã‚‚ã®', mean: 'Ä‘á»“ giáº·t', type: 'N' },
                { id: 5, word: 'éŠåœ’åœ°', reading: 'ã‚†ã†ãˆã‚“ã¡', mean: 'khu vui chÆ¡i giáº£i trÃ­', type: 'N' },
                { id: 6, word: 'ãƒã‚¤ã‚­ãƒ³ã‚°', reading: 'ãƒã‚¤ã‚­ãƒ³ã‚°', mean: 'leo nÃºi, dÃ£ ngoáº¡i', type: 'N' },
                { id: 7, word: 'å³ã—ã„', reading: 'ãã³ã—ã„', mean: 'nghiÃªm kháº¯c', type: 'A' },
                { id: 8, word: 'æ··ã‚€', reading: 'ã“ã‚€', mean: 'Ä‘Ã´ng Ä‘Ãºc', type: 'V' },
                { id: 9, word: 'ä¸ŠãŒã‚‹', reading: 'ã‚ãŒã‚‹', mean: 'leo lÃªn, tÄƒng lÃªn', type: 'V' },
                { id: 10, word: 'ä¸‹ãŒã‚‹', reading: 'ã•ãŒã‚‹', mean: 'giáº£m xuá»‘ng, háº¡ xuá»‘ng', type: 'V' },
                { id: 11, word: 'ä¹¾ã', reading: 'ã‹ã‚ã', mean: 'khÃ´ (quáº§n Ã¡o)', type: 'V' },
                { id: 12, word: 'æ­¢ã‚€', reading: 'ã‚„ã‚€', mean: 'táº¡nh (mÆ°a)', type: 'V' },
                { id: 13, word: 'å¶ã†', reading: 'ã‹ãªã†', mean: 'thÃ nh hiá»‡n thá»±c', type: 'V' },
                { id: 14, word: 'æ¥½ã—ã‚€', reading: 'ãŸã®ã—ã‚€', mean: 'táº­n hÆ°á»Ÿng', type: 'V' },
                { id: 15, word: 'å”åŠ›', reading: 'ãã‚‡ã†ã‚Šã‚‡ã', mean: 'há»£p tÃ¡c, hiá»‡p lá»±c', type: 'N/V' },
                { id: 16, word: 'å‹•ç”»', reading: 'ã©ã†ãŒ', mean: 'Video, Clip', type: 'N' },
                { id: 17, word: 'æ„Ÿå‹•', reading: 'ã‹ã‚“ã©ã†', mean: 'cáº£m Ä‘á»™ng', type: 'N/V' }
            ],
            kanji: [
                { id: 1, char: 'åŠ›', onyomi: 'ãƒªãƒ§ã‚¯, ãƒªã‚­', kunyomi: 'ã¡ã‹ã‚‰', mean: 'Lá»°C (Sá»©c máº¡nh)', examples: ['å”åŠ› (ãã‚‡ã†ã‚Šã‚‡ã): Hiá»‡p lá»±c'] },
                { id: 2, char: 'å‹•', onyomi: 'ãƒ‰ã‚¦', kunyomi: 'ã†ã”(ã)', mean: 'Äá»˜NG (Chuyá»ƒn Ä‘á»™ng)', examples: ['å‹•ç‰© (ã©ã†ã¶ã¤): Äá»™ng váº­t', 'é‹å‹• (ã†ã‚“ã©ã†): Váº­n Ä‘á»™ng'] },
                { id: 3, char: 'åƒ', onyomi: 'ãƒ‰ã‚¦', kunyomi: 'ã¯ãŸã‚‰(ã)', mean: 'Äá»˜NG (LÃ m viá»‡c)', examples: ['åƒãã¾ã™: LÃ m viá»‡c'] },
                { id: 4, char: 'çŸ¥', onyomi: 'ãƒ', kunyomi: 'ã—(ã‚‹)', mean: 'TRI (Biáº¿t)', examples: ['çŸ¥ã‚‰ã›ã‚‹: ThÃ´ng bÃ¡o', 'çŸ¥è­˜ (ã¡ã—ã): Tri thá»©c'] },
                { id: 5, char: 'çŸ­', onyomi: 'ã‚¿ãƒ³', kunyomi: 'ã¿ã˜ã‹(ã„)', mean: 'ÄOáº¢N (Ngáº¯n)', examples: ['çŸ­æ°— (ãŸã‚“ã): NÃ³ng tÃ­nh', 'çŸ­ã„: Ngáº¯n'] },
                { id: 6, char: 'åŒ»', onyomi: 'ã‚¤', kunyomi: '-', mean: 'Y (Y há»c)', examples: ['åŒ»è€… (ã„ã—ã‚ƒ): BÃ¡c sÄ©', 'åŒ»å­¦ (ã„ãŒã): Y há»c'] },
                { id: 7, char: 'çš¿', onyomi: 'ãƒ™ã‚¤', kunyomi: 'ã•ã‚‰', mean: 'MÃƒNH (CÃ¡i Ä‘Ä©a)', examples: ['ãŠçš¿: CÃ¡i Ä‘Ä©a', 'ç°çš¿ (ã¯ã„ã–ã‚‰): Gáº¡t tÃ n'] },
                { id: 8, char: 'è¡€', onyomi: 'ã‚±ãƒ„', kunyomi: 'ã¡', mean: 'HUYáº¾T (MÃ¡u)', examples: ['å‡ºè¡€ (ã—ã‚…ã£ã‘ã¤): Xuáº¥t huyáº¿t'] },
                { id: 9, char: 'æ‘', onyomi: 'ã‚½ãƒ³', kunyomi: 'ã‚€ã‚‰', mean: 'THÃ”N (LÃ ng)', examples: ['æ‘é•· (ãã‚“ã¡ã‚‡ã†): TrÆ°á»Ÿng thÃ´n'] },
                { id: 10, char: 'åŒº', onyomi: 'ã‚¯', kunyomi: '-', mean: 'KHU (Quáº­n)', examples: ['åœ°åŒº (ã¡ã): Äá»‹a khu', 'åŒºå½¹æ‰€: á»¦y ban quáº­n'] },
                { id: 11, char: 'å›³', onyomi: 'ã‚º, ãƒˆ', kunyomi: 'ã¯ã‹(ã‚‹)', mean: 'Äá»’ (Báº£n Ä‘á»“, váº½)', examples: ['åœ°å›³ (ã¡ãš): Báº£n Ä‘á»“', 'å›³æ›¸é¤¨ (ã¨ã—ã‚‡ã‹ã‚“): ThÆ° viá»‡n'] },
                { id: 12, char: 'é€²', onyomi: 'ã‚·ãƒ³', kunyomi: 'ã™ã™(ã‚€)', mean: 'TIáº¾N (Tiáº¿n lÃªn)', examples: ['é€²åŒ– (ã—ã‚“ã‹): Tiáº¿n hÃ³a'] },
                { id: 13, char: 'é›†', onyomi: 'ã‚·ãƒ¥ã‚¦', kunyomi: 'ã‚ã¤(ã‚ã‚‹)', mean: 'Táº¬P (Táº­p há»£p)', examples: ['é›†ä¸­ (ã—ã‚…ã†ã¡ã‚…ã†): Táº­p trung'] },
                { id: 14, char: 'å–¶', onyomi: 'ã‚¨ã‚¤', kunyomi: 'ã„ã¨ãª(ã‚€)', mean: 'DOANH (Kinh doanh)', examples: ['å–¶æ¥­ (ãˆã„ãã‚‡ã†): Kinh doanh'] },
                { id: 15, char: 'æ¥­', onyomi: 'ã‚®ãƒ§ã‚¦', kunyomi: 'ã‚ã–', mean: 'NGHIá»†P (Nghá» nghiá»‡p)', examples: ['æˆæ¥­ (ã˜ã‚…ãã‚‡ã†): Giá» há»c'] }
            ],
            grammar: [
                {
                    id: 1,
                    title: 'Thá»ƒ thÆ°á»ng / N / Aãª + ã§ã—ã‚‡ã† / ã ã‚ã†',
                    usage: 'PhÃ¡n Ä‘oÃ¡n (Cháº¯c háº³n lÃ ...)',
                    explain: 'Sá»­ dá»¥ng khi Ä‘Æ°a ra phÃ¡n Ä‘oÃ¡n mÃ  ngÆ°á»i nÃ³i tin ráº±ng tá»‰ lá»‡ xáº£y ra khÃ¡ cao.ã€Œã ã‚ã†ã€ lÃ  thá»ƒ thÆ°á»ng cá»§a ã€Œã§ã—ã‚‡ã†ã€.',
                    examples: [
                        'ãŸãã•ã‚“å‹‰å¼·ã—ãŸã‹ã‚‰ã€ãã£ã¨åˆæ ¼ã™ã‚‹ã ã‚ã†ã€‚ (VÃ¬ Ä‘Ã£ há»c nhiá»u nÃªn cháº¯c cháº¯n sáº½ Ä‘á»— thÃ´i.)',
                        'æ˜æ—¥ã¯é›¨ã§ã—ã‚‡ã†ã€‚ (NgÃ y mai cháº¯c háº³n lÃ  mÆ°a.)'
                    ]
                },
                {
                    id: 2,
                    title: 'ï½ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“',
                    usage: 'CÃ³ láº½, khÃ´ng biáº¿t chá»«ng',
                    explain: 'Diá»…n táº£ phÃ¡n Ä‘oÃ¡n cá»§a ngÆ°á»i nÃ³i vá»›i má»©c Ä‘á»™ cháº¯c cháº¯n tháº¥p hÆ¡n "deshou" (khoáº£ng 50%).',
                    examples: [
                        'ç´„æŸã®æ™‚é–“ã«é–“ã«åˆã‚ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ (CÃ³ láº½ sáº½ khÃ´ng ká»‹p giá» háº¹n.)'
                    ]
                },
                {
                    id: 3,
                    title: 'ï½ã¿ãŸã„ã ',
                    usage: 'HÃ¬nh nhÆ° (PhÃ¡n Ä‘oÃ¡n dá»±a trÃªn giÃ¡c quan)',
                    explain: 'DÃ¹ng trong vÄƒn nÃ³i. Giá»‘ng vá»›i "youda" nhÆ°ng suá»“ng sÃ£ hÆ¡n. PhÃ¡n Ä‘oÃ¡n dá»±a trÃªn váº» ngoÃ i hoáº·c thÃ´ng tin nghe Ä‘Æ°á»£c.',
                    examples: [
                        'å½¼ã¯ç–²ã‚Œã¦ã„ã‚‹ã¿ãŸã„ã ã€‚ (Anh áº¥y cÃ³ váº» Ä‘ang má»‡t.)'
                    ]
                },
                {
                    id: 4,
                    title: 'ï½ã‚ˆã†ã§ã™',
                    usage: 'HÃ¬nh nhÆ°, cÃ³ váº»',
                    explain: 'PhÃ¡n Ä‘oÃ¡n dá»±a trÃªn thÃ´ng tin, cáº£m nháº­n chá»§ quan cá»§a ngÆ°á»i nÃ³i. Lá»‹ch sá»± hÆ¡n "mitaida".',
                    examples: [
                        'å¤–ã¯é›¨ãŒé™ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ (BÃªn ngoÃ i cÃ³ váº» trá»i Ä‘ang mÆ°a.)'
                    ]
                },
                {
                    id: 5,
                    title: 'ï½ã¯ãšã§ã™',
                    usage: 'Cháº¯c cháº¯n lÃ ',
                    explain: 'PhÃ¡n Ä‘oÃ¡n dá»±a trÃªn lÃ½ do xÃ¡c thá»±c, logic. NgÆ°á»i nÃ³i ráº¥t tin tÆ°á»Ÿng vÃ o phÃ¡n Ä‘oÃ¡n nÃ y.',
                    examples: [
                        'ç”°ä¸­ã•ã‚“ã¯æ—¥æœ¬ã«10å¹´ä½ã‚“ã§ã„ãŸã‹ã‚‰ã€æ—¥æœ¬èªãŒä¸Šæ‰‹ãªã¯ãšã§ã™ã€‚ (VÃ¬ anh Tanaka sá»‘ng á»Ÿ Nháº­t 10 nÄƒm nÃªn tiáº¿ng Nháº­t cháº¯c cháº¯n giá»i.)'
                    ]
                }
            ],
            reading: `
                <p class="mb-4">
                    ä»Šæ—¥ã¯æ—¥æ›œæ—¥ã§ã™ã€‚å¤©æ°—äºˆå ±ã«ã‚ˆã‚‹ã¨ã€åˆå¾Œã¯<span class="highlight-word" data-word="å°é¢¨">å°é¢¨</span>ãŒæ¥ã‚‹<span class="highlight-word" data-word="ã§ã—ã‚‡ã†">ã§ã—ã‚‡ã†</span>ã€‚
                    ã§ã™ã‹ã‚‰ã€ç§ã¯å®¶ã§<span class="highlight-word" data-word="æ´—æ¿¯ç‰©">æ´—æ¿¯ç‰©</span>ã‚’ç‰‡ä»˜ã‘ãŸã‚Šã€éƒ¨å±‹ã‚’æƒé™¤ã—ãŸã‚Šã™ã‚‹ã¤ã‚‚ã‚Šã§ã™ã€‚
                </p>
                <p class="mb-4">
                    æœ¬å½“ã¯å‹é”ã¨<span class="highlight-word" data-word="éŠåœ’åœ°">éŠåœ’åœ°</span>ã¸è¡Œãç´„æŸãŒã‚ã‚Šã¾ã—ãŸã€‚ã§ã‚‚ã€å¤©æ°—ãŒæ‚ªã„ã®ã§ã€
                    <span class="highlight-word" data-word="ãƒã‚¤ã‚­ãƒ³ã‚°">ãƒã‚¤ã‚­ãƒ³ã‚°</span>ã‚„éŠã³ã«è¡Œãã®ã¯ç„¡ç†<span class="highlight-word" data-word="ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“">ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“</span>ã€‚
                    æ®‹å¿µã§ã™ãŒã€å®¶ã§<span class="highlight-word" data-word="å‹•ç”»">å‹•ç”»</span>ã‚’è¦‹ã¦<span class="highlight-word" data-word="æ¥½ã—ã‚€">æ¥½ã—ã‚€</span>ã“ã¨ã«ã—ã¾ã™ã€‚
                </p>
                <p>
                    æœ€è¿‘ã€ä»•äº‹ãŒ<span class="highlight-word" data-word="æ··ã‚€">æ··ã‚€</span>ã®ã§ã€ã‚ã¾ã‚Šä¼‘ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚
                    ä»Šæ—¥ã¯ã‚†ã£ãã‚Šä¼‘ã‚“ã§ã€æ˜æ—¥ã‹ã‚‰ã¾ãŸ<span class="highlight-word" data-word="å”åŠ›">å”åŠ›</span>ã—ã¦<span class="highlight-word" data-word="åƒã">åƒã</span>ã¤ã‚‚ã‚Šã§ã™ã€‚
                </p>
            `
        };

        // --- APPLICATION LOGIC ---
        const app = {
            state: {
                currentTab: 'plan',
                vocabIndex: 0,
                vocabMode: 'flashcard', // 'flashcard' or 'quiz'
                studyDuration: 3,
                kanjiProgress: {}, // Store kanji id -> 'easy'/'good'/'hard'
            },

            init: function() {
                this.renderVocabCard();
                this.renderKanjiGrid();
                this.renderGrammar();
                this.renderReading();
                this.generatePlan();
                
                // Initialize Chart
                const ctx = document.getElementById('progressChart').getContext('2d');
                this.chart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['Tá»« Vá»±ng', 'Ngá»¯ PhÃ¡p', 'Kanji', 'Äá»c', 'Nghe'],
                        datasets: [{
                            label: 'NÄƒng lá»±c hiá»‡n táº¡i',
                            data: [20, 15, 30, 10, 5],
                            backgroundColor: 'rgba(236, 72, 153, 0.2)',
                            borderColor: 'rgba(236, 72, 153, 1)',
                            pointBackgroundColor: 'rgba(236, 72, 153, 1)',
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        scales: { r: { suggestedMin: 0, suggestedMax: 100 } },
                        plugins: { legend: { display: false } }
                    }
                });
            },

            // --- TAB NAVIGATION ---
            switchTab: function(tabId) {
                document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
                document.getElementById(`tab-${tabId}`).classList.add('active');
                
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active', 'text-pink-600', 'border-b-2', 'border-pink-600'));
                const btn = document.querySelector(`.nav-item[onclick="app.switchTab('${tabId}')"]`);
                if(btn) {
                    btn.classList.add('active', 'text-pink-600');
                    // Reset styling for others
                    document.querySelectorAll('.nav-item:not(.active)').forEach(el => el.classList.add('text-gray-500'));
                }
            },

            // --- STUDY PLAN LOGIC ---
            generatePlan: function() {
                const duration = parseInt(document.getElementById('plan-duration').value);
                const taskList = document.getElementById('daily-tasks');
                taskList.innerHTML = '';

                let tasks = [];
                if (duration === 1) {
                    tasks = ['Há»c 20 tá»« vá»±ng chÆ°Æ¡ng 15', 'Ã”n 10 Kanji (Äá»™ng, Lá»±c...)', 'LÃ m 1 bÃ i Ä‘á»c hiá»ƒu ngáº¯n'];
                } else if (duration === 3) {
                    tasks = ['Há»c 10 tá»« vá»±ng má»›i', 'Ã”n táº­p ngá»¯ phÃ¡p "Deshou"', 'Viáº¿t 5 cÃ¢u vÃ­ dá»¥'];
                } else {
                    tasks = ['Nghe thá»¥ Ä‘á»™ng 15 phÃºt', 'Xem láº¡i 5 Kanji cÅ©', 'Äá»c 1 Ä‘oáº¡n vÄƒn ngáº¯n'];
                }

                tasks.forEach(task => {
                    const li = document.createElement('li');
                    li.className = 'flex items-center gap-3 p-3 bg-pink-50 rounded-lg';
                    li.innerHTML = `
                        <input type="checkbox" class="form-checkbox h-5 w-5 text-pink-600 rounded focus:ring-pink-500" onchange="app.updateProgress(this)">
                        <span class="text-gray-700">${task}</span>
                        <a href="#" onclick="app.switchTab('vocab')" class="ml-auto text-xs text-pink-500 font-bold uppercase">Äi tá»›i</a>
                    `;
                    taskList.appendChild(li);
                });
            },

            updateProgress: function(checkbox) {
                const total = document.querySelectorAll('#daily-tasks input[type="checkbox"]').length;
                const checked = document.querySelectorAll('#daily-tasks input[type="checkbox"]:checked').length;
                const percent = Math.round((checked / total) * 100);
                
                document.getElementById('global-progress-text').textContent = `${percent}%`;
                const offset = 100 - percent;
                document.getElementById('global-progress-ring').style.strokeDashoffset = offset;
            },

            // --- VOCAB LOGIC ---
            setVocabMode: function(mode) {
                this.state.vocabMode = mode;
                if (mode === 'flashcard') {
                    document.getElementById('vocab-flashcard-view').classList.remove('hidden');
                    document.getElementById('vocab-quiz-view').classList.add('hidden');
                    document.getElementById('btn-flashcard').className = "px-4 py-1 rounded-md text-sm font-bold bg-white text-pink-600 shadow transition";
                    document.getElementById('btn-quiz').className = "px-4 py-1 rounded-md text-sm font-bold text-gray-500 hover:bg-gray-100 transition";
                } else {
                    document.getElementById('vocab-flashcard-view').classList.add('hidden');
                    document.getElementById('vocab-quiz-view').classList.remove('hidden');
                    document.getElementById('btn-quiz').className = "px-4 py-1 rounded-md text-sm font-bold bg-white text-pink-600 shadow transition";
                    document.getElementById('btn-flashcard').className = "px-4 py-1 rounded-md text-sm font-bold text-gray-500 hover:bg-gray-100 transition";
                    this.generateQuiz();
                }
            },

            renderVocabCard: function() {
                const card = database.vocab[this.state.vocabIndex];
                document.getElementById('fc-word').textContent = card.word;
                document.getElementById('fc-reading').textContent = card.reading;
                document.getElementById('fc-meaning').textContent = card.mean;
                document.getElementById('fc-type').textContent = card.type;
                document.getElementById('fc-current').textContent = this.state.vocabIndex + 1;
                document.getElementById('fc-total').textContent = database.vocab.length;
                
                // Reset flip
                document.querySelector('.card-flip').classList.remove('flipped');
            },

            nextCard: function() {
                if (this.state.vocabIndex < database.vocab.length - 1) {
                    this.state.vocabIndex++;
                    this.renderVocabCard();
                }
            },

            prevCard: function() {
                if (this.state.vocabIndex > 0) {
                    this.state.vocabIndex--;
                    this.renderVocabCard();
                }
            },

            generateQuiz: function() {
                const currentVocab = database.vocab[Math.floor(Math.random() * database.vocab.length)];
                document.getElementById('quiz-question').textContent = currentVocab.word;
                document.getElementById('quiz-feedback').textContent = '';
                
                const optionsContainer = document.getElementById('quiz-options');
                optionsContainer.innerHTML = '';
                
                // Get 3 random wrong answers + 1 right
                let options = [currentVocab];
                while(options.length < 4) {
                    let random = database.vocab[Math.floor(Math.random() * database.vocab.length)];
                    if(!options.includes(random)) options.push(random);
                }
                // Shuffle
                options.sort(() => Math.random() - 0.5);
                
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = "w-full p-4 bg-gray-50 hover:bg-pink-50 border border-gray-200 rounded-xl transition text-gray-700 font-medium";
                    btn.textContent = opt.mean;
                    btn.onclick = () => {
                        if(opt.id === currentVocab.id) {
                            btn.className = "w-full p-4 bg-green-500 text-white border border-green-600 rounded-xl transition font-bold";
                            document.getElementById('quiz-feedback').textContent = "ChÃ­nh xÃ¡c! ğŸ‰";
                            document.getElementById('quiz-feedback').className = "mt-4 h-6 text-sm font-bold text-green-600";
                            setTimeout(() => app.generateQuiz(), 1500);
                        } else {
                            btn.className = "w-full p-4 bg-red-400 text-white border border-red-500 rounded-xl transition";
                            document.getElementById('quiz-feedback').textContent = "Sai rá»“i, thá»­ láº¡i nhÃ©!";
                            document.getElementById('quiz-feedback').className = "mt-4 h-6 text-sm font-bold text-red-500";
                        }
                    };
                    optionsContainer.appendChild(btn);
                });
            },

            // --- KANJI LOGIC ---
            renderKanjiGrid: function() {
                const container = document.getElementById('kanji-grid');
                container.innerHTML = '';
                
                database.kanji.forEach(k => {
                    const div = document.createElement('div');
                    // Check progress color
                    let bgClass = "bg-white";
                    if(this.state.kanjiProgress[k.id] === 'hard') bgClass = "bg-red-50 border-red-200";
                    if(this.state.kanjiProgress[k.id] === 'good') bgClass = "bg-blue-50 border-blue-200";
                    if(this.state.kanjiProgress[k.id] === 'easy') bgClass = "bg-green-50 border-green-200";

                    div.className = `${bgClass} p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col items-center justify-center cursor-pointer hover:shadow-md transition transform hover:-translate-y-1`;
                    div.innerHTML = `
                        <span class="text-3xl font-bold text-gray-800 kanji-font">${k.char}</span>
                        <span class="text-[10px] text-gray-500 mt-1 uppercase truncate w-full text-center">${k.mean.split('(')[0]}</span>
                    `;
                    div.onclick = () => app.openKanjiModal(k);
                    container.appendChild(div);
                });
            },

            openKanjiModal: function(kanji) {
                this.currentKanjiId = kanji.id;
                document.getElementById('k-modal-char').textContent = kanji.char;
                document.getElementById('k-modal-mean').textContent = kanji.mean;
                document.getElementById('k-modal-on').textContent = kanji.onyomi;
                document.getElementById('k-modal-kun').textContent = kanji.kunyomi;
                
                const ul = document.getElementById('k-modal-examples');
                ul.innerHTML = '';
                kanji.examples.forEach(ex => {
                    const li = document.createElement('li');
                    li.textContent = ex;
                    ul.appendChild(li);
                });
                
                document.getElementById('kanji-modal').classList.remove('hidden');
            },

            closeKanjiModal: function() {
                document.getElementById('kanji-modal').classList.add('hidden');
            },

            rateKanji: function(rating) {
                this.state.kanjiProgress[this.currentKanjiId] = rating;
                this.renderKanjiGrid(); // Refresh colors
                this.closeKanjiModal();
            },

            // --- GRAMMAR LOGIC ---
            renderGrammar: function() {
                const list = document.getElementById('grammar-list');
                database.grammar.forEach(g => {
                    const div = document.createElement('div');
                    div.className = "bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm";
                    div.innerHTML = `
                        <button onclick="this.parentElement.classList.toggle('active')" class="w-full text-left p-4 bg-white hover:bg-gray-50 flex justify-between items-center transition">
                            <div>
                                <h3 class="font-bold text-gray-800 text-lg">${g.title}</h3>
                                <p class="text-sm text-gray-500">${g.usage}</p>
                            </div>
                            <span class="text-pink-500 text-xl transform transition-transform duration-200 rotate-0">â–¼</span>
                        </button>
                        <div class="hidden-content bg-gray-50 p-4 border-t border-gray-100 hidden">
                            <p class="text-gray-700 mb-3 italic">${g.explain}</p>
                            <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-100">
                                <span class="text-xs font-bold text-yellow-600 block mb-1">VÃ­ dá»¥:</span>
                                <ul class="list-disc list-inside text-sm text-gray-800 space-y-1">
                                    ${g.examples.map(ex => `<li>${ex}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    `;
                    // Simple inline toggle logic embedded in button onclick
                    div.querySelector('button').onclick = function() {
                        const content = this.nextElementSibling;
                        const icon = this.querySelector('span');
                        if (content.classList.contains('hidden')) {
                            content.classList.remove('hidden');
                            icon.style.transform = 'rotate(180deg)';
                        } else {
                            content.classList.add('hidden');
                            icon.style.transform = 'rotate(0deg)';
                        }
                    };
                    list.appendChild(div);
                });
            },

            // --- READING LOGIC ---
            renderReading: function() {
                document.getElementById('reading-content').innerHTML = database.reading;
                
                document.querySelectorAll('.highlight-word').forEach(span => {
                    span.addEventListener('click', (e) => {
                        const wordText = e.target.getAttribute('data-word');
                        // Find logic (relaxed matching)
                        let found = database.vocab.find(v => v.word === wordText || v.reading === wordText);
                        
                        // Fallback lookup if exact match fails (e.g. conjugated verbs)
                        if (!found) {
                            if (wordText === 'åƒã') found = database.vocab.find(v => v.word.includes('åƒ'));
                            if (wordText === 'ã§ã—ã‚‡ã†') found = database.grammar.find(g => g.title.includes('ã§ã—ã‚‡ã†'));
                        }

                        const modal = document.getElementById('lookup-modal');
                        if (found) {
                            // Is it grammar or vocab?
                            if (found.title) { // Grammar
                                document.getElementById('lookup-word').textContent = found.title;
                                document.getElementById('lookup-reading').textContent = "Ngá»¯ phÃ¡p";
                                document.getElementById('lookup-mean').textContent = found.usage + ": " + found.explain;
                            } else { // Vocab
                                document.getElementById('lookup-word').textContent = found.word;
                                document.getElementById('lookup-reading').textContent = found.reading;
                                document.getElementById('lookup-mean').textContent = found.mean;
                            }
                            modal.classList.remove('hidden');
                        } else {
                            // Generic fallback
                            document.getElementById('lookup-word').textContent = wordText;
                            document.getElementById('lookup-reading').textContent = "---";
                            document.getElementById('lookup-mean').textContent = "KhÃ´ng tÃ¬m tháº¥y trong cÆ¡ sá»Ÿ dá»¯ liá»‡u hiá»‡n táº¡i.";
                            modal.classList.remove('hidden');
                        }
                    });
                });
            }
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

    </script>
    
    <!-- CONFIRMATION: NO SVG graphics used (except inline SVG icons). NO Mermaid JS used. -->
</body>
</html>
