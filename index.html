import React, { useState, useEffect } from 'react';
import { 
  BookOpen, 
  Type, 
  PenTool, 
  AlignLeft, 
  Map, 
  ChevronRight, 
  ChevronLeft, 
  RotateCcw,
  CheckCircle2,
  XCircle,
  Lightbulb,
  Search,
  CalendarDays
} from 'lucide-react';

// --- DATA CẤP NHẬT TỪ CÁC FILE PDF ---

const vocabData = [
  { kanji: "本物", kana: "ほんもの", meaning: "hàng thật, đồ thật", type: "Danh từ" },
  { kanji: "彼", kana: "かれ", meaning: "anh ấy, bạn trai", type: "Danh từ" },
  { kanji: "台風", kana: "たいふう", meaning: "cơn bão", type: "Danh từ" },
  { kanji: "厳しい", kana: "きびしい", meaning: "nghiêm khắc, khắt khe", type: "Tính từ đuôi い" },
  { kanji: "混む", kana: "こむ", meaning: "đông đúc, chen lấn", type: "Động từ" },
  { kanji: "風邪", kana: "かぜ", meaning: "cảm lạnh, cảm cúm", type: "Danh từ" },
  { kanji: "事故", kana: "じこ", meaning: "tai nạn", type: "Danh từ" },
  { kanji: "真っ暗", kana: "まっくら", meaning: "tối om", type: "Tính từ đuôi な" },
  { kanji: "勝つ", kana: "かつ", meaning: "thắng, chiến thắng", type: "Động từ" },
  { kanji: "うれしい", kana: "うれしい", meaning: "vui vẻ", type: "Tính từ đuôi い" }
];

const kanjiData = [
  { kanji: "力", onyomi: "リョク, リキ", kunyomi: "ちから", meaning: "LỰC (Sức mạnh)", examples: "協力 (Hợp tác)", mnemonic: "Hình ảnh cánh tay đang gồng lên khoe cơ bắp, thể hiện sức mạnh." },
  { kanji: "動", onyomi: "ドウ", kunyomi: "うご・く", meaning: "ĐỘNG (Cử động, chuyển động)", examples: "運動 (Vận động), 動物 (Động vật)", mnemonic: "Sức mạnh (力) dồn vào vật nặng (重) làm nó chuyển ĐỘNG." },
  { kanji: "働", onyomi: "ドウ", kunyomi: "はたら・く", meaning: "ĐỘNG (Làm việc)", examples: "働きます (Làm việc)", mnemonic: "Người (亻) ĐỘNG (動) đậy chân tay liên tục tức là đang làm việc." },
  { kanji: "知", onyomi: "チ", kunyomi: "し・る", meaning: "TRI (Biết)", examples: "お知らせ (Thông báo)", mnemonic: "Miệng (口) nói ra những điều nhanh như mũi tên (矢) bay, chứng tỏ là người có TRI thức." },
  { kanji: "短", onyomi: "タン", kunyomi: "みじか・い", meaning: "ĐOẢN (Ngắn)", examples: "短い (Ngắn), 短気 (Nóng nảy)", mnemonic: "Mũi tên (矢) bay cạnh hạt đậu (豆) tạo nên khoảng cách RẤT NGẮN." },
];

const grammarData = [
  {
    structure: "Thể thường/ N/Aな + でしょう / だろう",
    meaning: "Chắc hẳn ~ / ~ phải không? (Phán đoán, xác nhận)",
    explanation: "Sử dụng khi đưa ra phán đoán, dự đoán và người nói tin rằng tỉ lệ xảy ra sự việc đó là khá cao. Hoặc dùng để xác nhận, kêu gọi sự đồng tình.",
    examples: [
      { jp: "明日は今日より気温が下がるでしょう。", vi: "Ngày mai chắc nhiệt độ sẽ giảm hơn hôm nay." },
      { jp: "たくさん勉強したから、きっと合格するだろうなあ。", vi: "Vì đã học nhiều nên chắc chắn sẽ thi đỗ thôi." }
    ]
  },
  {
    structure: "Thể thường + かもしれない",
    meaning: "Có lẽ ~ / Có khi không chừng",
    explanation: "Dùng để diễn tả phán đoán của người nói về một khả năng nào đó. Mức độ chắc chắn cao hay thấp đều dùng được.",
    examples: [
      { jp: "忙しいから、飲み会に行けないかもしれません。", vi: "Vì bận nên có lẽ tôi không thể đi nhậu được." },
      { jp: "もしかしたら、あの人はベトナム人かもしれませんね。", vi: "Không chừng người kia là người Việt Nam đấy." }
    ]
  },
  {
    structure: "Thể thường + みたいだ / ようだ",
    meaning: "Hình như ~ / Có vẻ ~",
    explanation: "Dùng để đưa ra phán đoán dựa trên điều bản thân nhìn thấy/nghe thấy. 'みたいだ' thường dùng trong văn nói, 'ようだ' trang trọng hơn.",
    examples: [
      { jp: "明日は台風みたいだね。", vi: "Ngày mai hình như có bão nhỉ." },
      { jp: "誰もいないようだ。", vi: "Có vẻ như không có ai ở đây cả." }
    ]
  }
];

const readingVocabDict = {
  "旅行": { kana: "りょこう", meaning: "Du lịch" },
  "台風": { kana: "たいふう", meaning: "Cơn bão" },
  "中止": { kana: "ちゅうし", meaning: "Hủy bỏ, đình chỉ" },
  "残念": { kana: "ざんねん", meaning: "Đáng tiếc" },
  "温泉": { kana: "おんせん", meaning: "Suối nước nóng" },
  "予定": { kana: "よてい", meaning: "Dự định" }
};


// --- CÁC COMPONENT CHÍNH ---

export default function App() {
  const [activeTab, setActiveTab] = useState('roadmap');

  const navItems = [
    { id: 'roadmap', icon: <Map size={20}/>, label: 'Lộ trình' },
    { id: 'vocab', icon: <BookOpen size={20}/>, label: 'Từ vựng' },
    { id: 'kanji', icon: <PenTool size={20}/>, label: 'Kanji' },
    { id: 'grammar', icon: <Type size={20}/>, label: 'Ngữ pháp' },
    { id: 'reading', icon: <AlignLeft size={20}/>, label: 'Đọc hiểu' },
  ];

  return (
    <div className="min-h-screen bg-slate-50 font-sans text-slate-800 flex flex-col md:flex-row">
      {/* Sidebar Navigation */}
      <aside className="w-full md:w-64 bg-white shadow-xl flex-shrink-0 z-10 md:min-h-screen sticky top-0">
        <div className="p-6 text-center border-b">
          <h1 className="text-2xl font-bold text-red-500 flex items-center justify-center gap-2">
            <span className="bg-red-500 text-white w-8 h-8 rounded-full flex items-center justify-center">N4</span>
            Mastery
          </h1>
          <p className="text-xs text-slate-500 mt-1">JLPT & NAT-Test Prep</p>
        </div>
        <nav className="p-4 flex md:flex-col gap-2 overflow-x-auto no-scrollbar">
          {navItems.map((item) => (
            <button
              key={item.id}
              onClick={() => setActiveTab(item.id)}
              className={`flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-medium whitespace-nowrap md:whitespace-normal
                ${activeTab === item.id 
                  ? 'bg-red-50 text-red-600 shadow-sm' 
                  : 'hover:bg-slate-100 text-slate-600 hover:text-slate-900'}`}
            >
              {item.icon}
              {item.label}
            </button>
          ))}
        </nav>
      </aside>

      {/* Main Content Area */}
      <main className="flex-1 p-4 md:p-8 overflow-y-auto">
        <div className="max-w-5xl mx-auto">
          {activeTab === 'roadmap' && <RoadmapTab onNavigate={setActiveTab} />}
          {activeTab === 'vocab' && <VocabTab />}
          {activeTab === 'kanji' && <KanjiTab />}
          {activeTab === 'grammar' && <GrammarTab />}
          {activeTab === 'reading' && <ReadingTab />}
        </div>
      </main>
    </div>
  );
}

/* =========================================
   TAB: LỘ TRÌNH (ROADMAP)
   ========================================= */
function RoadmapTab({ onNavigate }) {
  const [duration, setDuration] = useState(3); // 1, 3, 6

  const plans = {
    1: [
      { week: "Tuần 1", title: "Củng cố nền tảng", desc: "Học 100 từ vựng cốt lõi & Ôn tập lại ngữ pháp N5. Nhấn mạnh vào động từ nhóm 1, 2, 3." },
      { week: "Tuần 2", title: "Kanji & Đọc hiểu nhanh", desc: "Mỗi ngày 15 chữ Kanji N4. Bắt đầu đọc các đoạn văn ngắn 100-150 chữ." },
      { week: "Tuần 3", title: "Ngữ pháp N4 & Nghe", desc: "Tập trung các cấu trúc: ~みたい, ~かもしれない, Kính ngữ, Khiêm nhường ngữ." },
      { week: "Tuần 4", title: "Luyện đề thực tế", desc: "Làm 3 đề JLPT/NAT-Test liên tục. Bấm giờ. Rút kinh nghiệm các lỗi sai." }
    ],
    3: [
      { week: "Tháng 1", title: "Từ vựng & Kanji chuyên sâu", desc: "Học toàn bộ 300 chữ Kanji N4 và 800 từ vựng. Sử dụng Flashcard mỗi ngày 30 phút." },
      { week: "Tháng 2", title: "Phá đảo Ngữ pháp", desc: "Học 80 mẫu ngữ pháp N4. Làm bài tập ứng dụng. Bắt đầu luyện đọc dịch từng câu." },
      { week: "Tháng 3", title: "Luyện Đề & Kỹ năng Đọc/Nghe", desc: "Giải đề mỗi cuối tuần. Luyện tập kỹ năng nghe bắt từ khóa. Ôn lại từ vựng bị sai." }
    ],
    6: [
      { week: "Tháng 1-2", title: "Xây móng Từ vựng", desc: "Học từ vựng theo chủ đề (Gia đình, Đời sống, Công sở). Kết hợp học 5 Kanji mỗi ngày." },
      { week: "Tháng 3-4", title: "Ngữ pháp & Hội thoại", desc: "Học ngữ pháp từ từ, áp dụng viết nhật ký. Tập nghe hội thoại thực tế." },
      { week: "Tháng 5", title: "Tăng tốc Đọc hiểu", desc: "Đọc báo NHK Easy, đọc truyện ngắn. Áp dụng ngữ pháp đã học để dịch đoạn văn dài." },
      { week: "Tháng 6", title: "Tổng ôn & Luyện đề", desc: "Tháng cuối chỉ tập trung giải đề NAT-Test và JLPT các năm trước. Rèn phản xạ thời gian." }
    ]
  };

  return (
    <div className="animate-in fade-in slide-in-from-bottom-4 duration-500">
      <div className="bg-white p-6 rounded-2xl shadow-sm mb-6 flex flex-col md:flex-row justify-between items-start md:items-center border border-slate-100">
        <div>
          <h2 className="text-3xl font-bold text-slate-800 mb-2">Lộ Trình Học Tập</h2>
          <p className="text-slate-500">Chọn lộ trình phù hợp với thời gian và mục tiêu của bạn.</p>
        </div>
        <div className="mt-4 md:mt-0 flex gap-2 bg-slate-100 p-1 rounded-xl">
          {[1, 3, 6].map(m => (
            <button 
              key={m}
              onClick={() => setDuration(m)}
              className={`px-4 py-2 rounded-lg font-medium transition-colors ${duration === m ? 'bg-white text-red-600 shadow-sm' : 'text-slate-500 hover:bg-slate-200'}`}
            >
              {m} Tháng
            </button>
          ))}
        </div>
      </div>

      <div className="grid gap-6 md:grid-cols-2">
        {plans[duration].map((phase, idx) => (
          <div key={idx} className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition-shadow relative overflow-hidden group">
            <div className="absolute top-0 left-0 w-1 h-full bg-red-400 transform -translate-x-1 group-hover:translate-x-0 transition-transform"></div>
            <div className="flex items-center gap-3 mb-3 text-red-500">
              <CalendarDays size={20} />
              <span className="font-bold text-sm tracking-wider uppercase">{phase.week}</span>
            </div>
            <h3 className="text-xl font-bold mb-2 text-slate-800">{phase.title}</h3>
            <p className="text-slate-600 leading-relaxed">{phase.desc}</p>
            <div className="mt-4 pt-4 border-t border-slate-100 flex gap-2">
              <button onClick={() => onNavigate('vocab')} className="text-sm px-3 py-1.5 bg-slate-100 hover:bg-red-50 hover:text-red-600 rounded-md transition-colors font-medium">Từ vựng</button>
              <button onClick={() => onNavigate('grammar')} className="text-sm px-3 py-1.5 bg-slate-100 hover:bg-red-50 hover:text-red-600 rounded-md transition-colors font-medium">Ngữ pháp</button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

/* =========================================
   TAB: TỪ VỰNG (VOCABULARY - FLASHCARD/QUIZ)
   ========================================= */
function VocabTab() {
  const [mode, setMode] = useState('flashcard'); // flashcard, quiz

  return (
    <div className="animate-in fade-in slide-in-from-bottom-4 duration-500">
      <div className="flex justify-between items-end mb-6">
        <div>
          <h2 className="text-3xl font-bold text-slate-800">Từ Vựng N4</h2>
          <p className="text-slate-500 mt-1">Ôn tập bằng Flashcard hoặc kiểm tra với Quiz.</p>
        </div>
        <div className="bg-slate-200 p-1 rounded-xl flex">
          <button 
            onClick={() => setMode('flashcard')}
            className={`px-4 py-2 rounded-lg font-medium text-sm transition-all ${mode === 'flashcard' ? 'bg-white shadow-sm text-red-600' : 'text-slate-500'}`}
          >
            Flashcard
          </button>
          <button 
            onClick={() => setMode('quiz')}
            className={`px-4 py-2 rounded-lg font-medium text-sm transition-all ${mode === 'quiz' ? 'bg-white shadow-sm text-red-600' : 'text-slate-500'}`}
          >
            Quiz Review
          </button>
        </div>
      </div>

      {mode === 'flashcard' ? <Flashcards data={vocabData} /> : <VocabQuiz data={vocabData} />}
    </div>
  );
}

function Flashcards({ data }) {
  const [currentIndex, setCurrentIndex] = useState(0);
  const [isFlipped, setIsFlipped] = useState(false);

  const nextCard = () => {
    setIsFlipped(false);
    setTimeout(() => setCurrentIndex((prev) => (prev + 1) % data.length), 150);
  };
  const prevCard = () => {
    setIsFlipped(false);
    setTimeout(() => setCurrentIndex((prev) => (prev === 0 ? data.length - 1 : prev - 1)), 150);
  };

  const card = data[currentIndex];

  return (
    <div className="flex flex-col items-center max-w-xl mx-auto mt-10">
      <div className="mb-4 text-slate-500 font-medium">Card {currentIndex + 1} / {data.length}</div>
      
      {/* Card Element */}
      <div 
        className="w-full h-80 bg-transparent cursor-pointer group perspective-1000"
        onClick={() => setIsFlipped(!isFlipped)}
      >
        <div className={`relative w-full h-full transition-transform duration-500 transform-style-preserve-3d shadow-xl rounded-3xl ${isFlipped ? 'rotate-y-180' : ''}`}>
          
          {/* Front */}
          <div className="absolute w-full h-full backface-hidden bg-white border-2 border-slate-100 rounded-3xl flex flex-col items-center justify-center p-8 text-center hover:border-red-200 transition-colors">
            <span className="text-slate-400 text-sm mb-4 border border-slate-200 px-3 py-1 rounded-full">{card.type}</span>
            <h3 className="text-7xl font-bold text-slate-800 mb-2">{card.kanji}</h3>
            <p className="text-slate-400 mt-6 flex items-center gap-2"><RotateCcw size={16}/> Chạm để lật</p>
          </div>

          {/* Back */}
          <div className="absolute w-full h-full backface-hidden bg-red-50 border-2 border-red-100 rounded-3xl flex flex-col items-center justify-center p-8 text-center rotate-y-180">
            <h4 className="text-3xl font-semibold text-red-500 mb-2">{card.kana}</h4>
            <div className="w-16 h-1 bg-red-200 rounded-full my-4"></div>
            <p className="text-2xl text-slate-700">{card.meaning}</p>
          </div>
        </div>
      </div>

      {/* Controls */}
      <div className="flex items-center gap-6 mt-10">
        <button onClick={prevCard} className="p-4 bg-white shadow-sm rounded-full hover:bg-slate-50 hover:scale-105 transition-all text-slate-600">
          <ChevronLeft size={24}/>
        </button>
        <button onClick={() => setIsFlipped(!isFlipped)} className="px-8 py-3 bg-red-500 text-white rounded-xl shadow-lg shadow-red-500/30 hover:bg-red-600 transition-all font-bold tracking-wide">
          LẬT THẺ
        </button>
        <button onClick={nextCard} className="p-4 bg-white shadow-sm rounded-full hover:bg-slate-50 hover:scale-105 transition-all text-slate-600">
          <ChevronRight size={24}/>
        </button>
      </div>
    </div>
  );
}

function VocabQuiz({ data }) {
  const [qIndex, setQIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [showResult, setShowResult] = useState(false);
  const [selectedAns, setSelectedAns] = useState(null);

  const currentQ = data[qIndex];
  
  // Generate random options
  const [options, setOptions] = useState([]);
  useEffect(() => {
    if (!showResult) {
      let answers = [currentQ.meaning];
      while(answers.length < 4) {
        let rand = data[Math.floor(Math.random() * data.length)].meaning;
        if (!answers.includes(rand)) answers.push(rand);
      }
      setOptions(answers.sort(() => Math.random() - 0.5));
      setSelectedAns(null);
    }
  }, [qIndex, currentQ, data, showResult]);

  const handleAnswer = (ans) => {
    if (selectedAns) return; // Prevent multiple clicks
    setSelectedAns(ans);
    if (ans === currentQ.meaning) setScore(score + 1);
    
    setTimeout(() => {
      if (qIndex < data.length - 1) {
        setQIndex(qIndex + 1);
      } else {
        setShowResult(true);
      }
    }, 1000);
  };

  const restart = () => {
    setQIndex(0); setScore(0); setShowResult(false); setSelectedAns(null);
  };

  if (showResult) {
    return (
      <div className="bg-white p-10 rounded-3xl shadow-sm border border-slate-100 text-center max-w-xl mx-auto mt-10">
        <h3 className="text-2xl font-bold text-slate-800 mb-4">Kết Quả Bài Test</h3>
        <div className="text-6xl font-black text-red-500 mb-6">{score} / {data.length}</div>
        <p className="text-slate-600 mb-8">{score > 7 ? 'Tuyệt vời! Bạn nắm từ vựng rất chắc.' : 'Hãy ôn tập thêm bằng Flashcard nhé!'}</p>
        <button onClick={restart} className="bg-slate-800 text-white px-8 py-3 rounded-xl font-bold hover:bg-slate-700 transition-colors">
          Làm Lại
        </button>
      </div>
    );
  }

  return (
    <div className="max-w-2xl mx-auto mt-6">
      <div className="flex justify-between items-center mb-6">
        <span className="text-slate-500 font-medium">Câu hỏi {qIndex + 1}/{data.length}</span>
        <span className="bg-red-100 text-red-600 px-3 py-1 rounded-lg font-bold text-sm">Điểm: {score}</span>
      </div>

      <div className="bg-white p-12 rounded-3xl shadow-sm border border-slate-100 text-center mb-6">
        <div className="text-slate-400 mb-2">{currentQ.type}</div>
        <h2 className="text-6xl font-bold text-slate-800 mb-2">{currentQ.kanji}</h2>
        <p className="text-xl text-slate-500">({currentQ.kana})</p>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        {options.map((opt, i) => {
          let btnClass = "bg-white border-2 border-slate-100 hover:border-red-300 text-slate-700 p-4 rounded-xl text-lg font-medium transition-all text-left";
          if (selectedAns) {
            if (opt === currentQ.meaning) btnClass = "bg-emerald-50 border-2 border-emerald-400 text-emerald-700 p-4 rounded-xl text-lg font-medium text-left";
            else if (opt === selectedAns) btnClass = "bg-red-50 border-2 border-red-400 text-red-700 p-4 rounded-xl text-lg font-medium text-left";
            else btnClass = "bg-slate-50 border-2 border-slate-100 text-slate-400 p-4 rounded-xl text-lg font-medium text-left opacity-50";
          }

          return (
            <button key={i} onClick={() => handleAnswer(opt)} className={btnClass} disabled={!!selectedAns}>
              {opt}
            </button>
          )
        })}
      </div>
    </div>
  );
}

/* =========================================
   TAB: KANJI (SRS / MNEMONICS)
   ========================================= */
function KanjiTab() {
  const [selectedKanji, setSelectedKanji] = useState(kanjiData[0]);

  return (
    <div className="animate-in fade-in slide-in-from-bottom-4 duration-500">
      <div className="mb-6">
        <h2 className="text-3xl font-bold text-slate-800">Kanji N4 - Học sâu nhớ lâu</h2>
        <p className="text-slate-500 mt-1">Kết hợp gợi ý nhớ (Mnemonics) và Lặp lại ngắt quãng (SRS).</p>
      </div>

      <div className="flex flex-col md:flex-row gap-6">
        {/* List */}
        <div className="md:w-1/3 bg-white p-4 rounded-2xl shadow-sm border border-slate-100 h-fit max-h-[600px] overflow-y-auto">
          <div className="grid grid-cols-5 md:grid-cols-3 gap-2">
            {kanjiData.map((k, idx) => (
              <button 
                key={idx} 
                onClick={() => setSelectedKanji(k)}
                className={`aspect-square flex items-center justify-center text-2xl font-bold rounded-xl transition-all
                  ${selectedKanji.kanji === k.kanji ? 'bg-red-500 text-white shadow-md' : 'bg-slate-50 text-slate-700 hover:bg-slate-200'}`}
              >
                {k.kanji}
              </button>
            ))}
          </div>
        </div>

        {/* Detail Panel */}
        <div className="md:w-2/3 bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden flex flex-col">
          <div className="bg-slate-800 p-8 text-center text-white flex-shrink-0">
            <h2 className="text-8xl font-black mb-4 drop-shadow-md">{selectedKanji.kanji}</h2>
            <p className="text-xl font-medium tracking-widest uppercase text-slate-300">{selectedKanji.meaning}</p>
          </div>
          
          <div className="p-8 flex-1 flex flex-col justify-between">
            <div>
              <div className="grid grid-cols-2 gap-4 mb-6">
                <div className="bg-slate-50 p-4 rounded-xl">
                  <p className="text-xs text-slate-500 font-bold mb-1 uppercase tracking-wider">Onyomi (Âm On)</p>
                  <p className="text-lg font-medium text-slate-800">{selectedKanji.onyomi}</p>
                </div>
                <div className="bg-slate-50 p-4 rounded-xl">
                  <p className="text-xs text-slate-500 font-bold mb-1 uppercase tracking-wider">Kunyomi (Âm Kun)</p>
                  <p className="text-lg font-medium text-slate-800">{selectedKanji.kunyomi}</p>
                </div>
              </div>

              <div className="mb-6">
                <p className="text-sm text-slate-500 font-bold mb-2 uppercase tracking-wider">Từ ví dụ</p>
                <p className="text-slate-800 text-lg">{selectedKanji.examples}</p>
              </div>

              <div className="bg-amber-50 border border-amber-200 p-4 rounded-xl mb-6">
                <div className="flex items-center gap-2 text-amber-700 font-bold mb-2">
                  <Lightbulb size={18} />
                  <span>Gợi ý nhớ (Mnemonic)</span>
                </div>
                <p className="text-amber-900 leading-relaxed">{selectedKanji.mnemonic}</p>
              </div>
            </div>

            {/* Simulated SRS Buttons */}
            <div>
              <p className="text-center text-xs text-slate-400 mb-3 uppercase tracking-wider font-bold">Mức độ ghi nhớ (Hệ thống SRS)</p>
              <div className="flex gap-2">
                <button className="flex-1 py-3 bg-rose-100 hover:bg-rose-200 text-rose-700 font-bold rounded-xl transition-colors">Lại từ đầu<br/><span className="text-xs font-normal opacity-70">(&lt; 1 phút)</span></button>
                <button className="flex-1 py-3 bg-orange-100 hover:bg-orange-200 text-orange-700 font-bold rounded-xl transition-colors">Khó<br/><span className="text-xs font-normal opacity-70">(10 phút)</span></button>
                <button className="flex-1 py-3 bg-emerald-100 hover:bg-emerald-200 text-emerald-700 font-bold rounded-xl transition-colors">Tốt<br/><span className="text-xs font-normal opacity-70">(1 ngày)</span></button>
                <button className="flex-1 py-3 bg-blue-100 hover:bg-blue-200 text-blue-700 font-bold rounded-xl transition-colors">Dễ<br/><span className="text-xs font-normal opacity-70">(4 ngày)</span></button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

/* =========================================
   TAB: NGỮ PHÁP (GRAMMAR)
   ========================================= */
function GrammarTab() {
  return (
    <div className="animate-in fade-in slide-in-from-bottom-4 duration-500">
      <div className="mb-6">
        <h2 className="text-3xl font-bold text-slate-800">Ngữ pháp N4</h2>
        <p className="text-slate-500 mt-1">Nắm chắc cấu trúc, ví dụ và cách giải thích.</p>
      </div>

      <div className="space-y-6">
        {grammarData.map((item, idx) => (
          <div key={idx} className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
            <div className="bg-slate-800 px-6 py-4 border-b border-slate-100 flex items-center justify-between flex-wrap gap-4">
              <h3 className="text-xl font-bold text-white tracking-wide">{item.structure}</h3>
              <span className="bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">{item.meaning}</span>
            </div>
            <div className="p-6">
              <p className="text-slate-700 leading-relaxed mb-6 bg-slate-50 p-4 rounded-xl border border-slate-100">
                <span className="font-bold text-slate-800 block mb-1">Cách dùng:</span>
                {item.explanation}
              </p>
              
              <div>
                <span className="font-bold text-slate-800 block mb-3">Ví dụ (例文):</span>
                <div className="space-y-4">
                  {item.examples.map((ex, eIdx) => (
                    <div key={eIdx} className="pl-4 border-l-4 border-red-400">
                      <p className="text-lg font-medium text-slate-800 mb-1">{ex.jp}</p>
                      <p className="text-slate-500">{ex.vi}</p>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

/* =========================================
   TAB: ĐỌC HIỂU (READING)
   ========================================= */
function ReadingTab() {
  const [selectedWord, setSelectedWord] = useState(null);

  const textPassage = [
    "来週、日本へ", { w: "旅行" }, "に行きます。",
    "しかし、天気予報によると、", { w: "台風" }, "が来るかもしれません。",
    "もし飛行機が飛ばなかったら、旅行は", { w: "中止" }, "になります。",
    "それはとても", { w: "残念" }, "です。北海道で", { w: "温泉" }, "に入る", { w: "予定" }, "でした。"
  ];

  const handleWordClick = (word) => {
    setSelectedWord(word);
  };

  return (
    <div className="animate-in fade-in slide-in-from-bottom-4 duration-500">
      <div className="mb-6">
        <h2 className="text-3xl font-bold text-slate-800">Luyện tập Đọc hiểu</h2>
        <p className="text-slate-500 mt-1">Bấm vào các từ được in đậm để tra nghĩa trực tiếp.</p>
      </div>

      <div className="flex flex-col lg:flex-row gap-6">
        <div className="lg:w-2/3 bg-white p-8 md:p-10 rounded-3xl shadow-sm border border-slate-100 text-lg leading-loose text-slate-800">
          <p className="mb-4 text-slate-400 text-sm font-bold uppercase tracking-wider flex items-center gap-2">
            <BookOpen size={16} /> Bài đọc 1: 計画 (Kế hoạch)
          </p>
          <div className="font-serif">
            {textPassage.map((item, idx) => {
              if (typeof item === 'string') {
                return <span key={idx}>{item}</span>;
              } else {
                return (
                  <span 
                    key={idx} 
                    onClick={() => handleWordClick(item.w)}
                    className="font-bold text-red-600 bg-red-50 px-1 rounded cursor-pointer hover:bg-red-500 hover:text-white transition-colors"
                  >
                    {item.w}
                  </span>
                )
              }
            })}
          </div>
        </div>

        <div className="lg:w-1/3">
          <div className="bg-slate-800 rounded-3xl p-6 text-white sticky top-8 shadow-lg shadow-slate-800/20">
            <h3 className="text-lg font-bold mb-4 flex items-center gap-2 border-b border-slate-600 pb-4">
              <Search size={20} className="text-red-400"/>
              Từ điển nhanh
            </h3>
            
            {selectedWord ? (
              <div className="animate-in slide-in-from-right-4 fade-in duration-300">
                <div className="text-4xl font-black mb-2 text-red-400">{selectedWord}</div>
                <div className="text-xl text-slate-300 mb-6">{readingVocabDict[selectedWord].kana}</div>
                <div className="bg-slate-700/50 p-4 rounded-xl border border-slate-600">
                  <p className="text-sm text-slate-400 mb-1 uppercase tracking-wider font-bold">Nghĩa tiếng Việt</p>
                  <p className="text-lg">{readingVocabDict[selectedWord].meaning}</p>
                </div>
              </div>
            ) : (
              <div className="py-10 text-center opacity-50 flex flex-col items-center">
                <Search size={48} className="mb-4" />
                <p>Bấm vào từ vựng được bôi đỏ trong bài đọc để xem nghĩa.</p>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}
