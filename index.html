<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N4 NAT-TEST Master AI | Luy·ªán thi ti·∫øng Nh·∫≠t th√¥ng minh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Chosen Palette: Sakura & Matcha Premium -->
    <!-- Application Structure Plan:
         1. Dashboard: L·ªô tr√¨nh c√° nh√¢n h√≥a v√† Bi·ªÉu ƒë·ªì ti·∫øn ƒë·ªô.
         2. Vocabulary: H·ªçc qua Flashcard v√† t·∫°o v√≠ d·ª• th√¥ng minh b·∫±ng ‚ú® AI.
         3. Kanji: Qu·∫£n l√Ω tr√≠ nh·ªõ ng·∫Øt qu√£ng (SRS).
         4. Grammar: Danh s√°ch b√†i h·ªçc k√®m t√≠nh nƒÉng ‚ú® Gi·∫£i th√≠ch chuy√™n s√¢u t·ª´ AI.
         5. AI Sensei: T√≠nh nƒÉng h·ªôi tho·∫°i ‚ú® Chatbot ƒë·ªÉ th·ª±c h√†nh tr·ª±c ti·∫øp c√°c m·∫´u c√¢u N4.
         6. Reading: ƒê·ªçc hi·ªÉu t∆∞∆°ng t√°c k√®m ‚ú® AI Quiz Generator.
    -->
    
    <style>
        body { font-family: 'Nunito', 'Noto Sans JP', sans-serif; background-color: #fdf2f8; }
        .kanji-font { font-family: 'Noto Sans JP', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .nav-item.active { color: #be185d; border-bottom: 2px solid #be185d; }
        
        /* Flashcard Animation */
        .card-flip { perspective: 1000px; }
        .card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.6s; transform-style: preserve-3d; }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .card-back { transform: rotateY(180deg); background-color: #ecfdf5; }
        .flipped .card-inner { transform: rotateY(180deg); }

        .chart-container { position: relative; width: 100%; max-width: 500px; height: 250px; margin: 0 auto; }
        
        /* Loading Spinner */
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #db2777; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-gray-800 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white shadow-sm z-10 p-4 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="bg-pink-500 text-white p-2 rounded-lg font-bold text-xl shadow-lg">N4</div>
            <div>
                <h1 class="font-bold text-lg leading-tight text-pink-700">N4 Master <span class="text-xs bg-yellow-100 text-yellow-700 px-1 rounded">AI</span></h1>
                <p class="text-xs text-gray-500">Luy·ªán thi th√¥ng minh v·ªõi Gemini</p>
            </div>
        </div>
        <div id="ai-status" class="text-[10px] font-bold text-green-500 bg-green-50 px-2 py-1 rounded-full animate-pulse">‚ú® AI S·∫¥N S√ÄNG</div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto bg-gray-50 relative pb-20 sm:pb-4">
        
        <!-- DASHBOARD -->
        <section id="tab-plan" class="tab-content active p-4 max-w-4xl mx-auto space-y-6">
            <div class="bg-white rounded-2xl shadow-sm p-6 border-l-4 border-pink-400">
                <h2 class="text-2xl font-bold text-gray-800 mb-2 italic">Ch√†o b·∫°n h·ªçc vi√™n!</h2>
                <p class="text-gray-600 mb-4">H√¥m nay b·∫°n mu·ªën AI h·ªó tr·ª£ g√¨ cho vi·ªác √¥n luy·ªán N4?</p>
                <div class="flex flex-wrap gap-2">
                    <button onclick="app.switchTab('sensei')" class="bg-pink-100 text-pink-700 px-3 py-1.5 rounded-full text-xs font-bold hover:bg-pink-200 transition">‚ú® Luy·ªán h·ªôi tho·∫°i</button>
                    <button onclick="app.aiGenerateMotivation()" id="btn-motivation" class="bg-yellow-100 text-yellow-700 px-3 py-1.5 rounded-full text-xs font-bold hover:bg-yellow-200 transition">‚ú® Nh·∫≠n l·ªùi khuy√™n</button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white rounded-2xl shadow-sm p-5 border border-gray-100">
                    <h3 class="font-bold text-lg text-gray-800 mb-4">üìà Ti·∫øn ƒë·ªô m·ª•c ti√™u</h3>
                    <div class="chart-container">
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-sm p-5">
                    <h3 class="font-bold text-lg text-gray-800 mb-4">üìÖ Nhi·ªám v·ª• AI ƒë·ªÅ xu·∫•t</h3>
                    <ul class="space-y-3" id="ai-daily-tasks">
                        <li class="flex items-center gap-2 p-2 bg-pink-50 rounded">
                            <span class="text-pink-500">‚úî</span>
                            <span class="text-sm">H·ªçc 10 t·ª´ v·ª±ng Ch∆∞∆°ng 15</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- VOCABULARY -->
        <section id="tab-vocab" class="tab-content p-4 max-w-3xl mx-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">T·ª´ V·ª±ng</h2>
                <button onclick="app.aiExplainVocab()" id="btn-vocab-ai" class="bg-white border-2 border-pink-500 text-pink-600 px-4 py-1.5 rounded-full text-sm font-bold hover:bg-pink-50 transition">‚ú® AI Gi·∫£i th√≠ch th√™m</button>
            </div>
            
            <div class="flex flex-col items-center gap-6">
                <div class="w-full max-w-md h-72 card-flip cursor-pointer group" onclick="this.classList.toggle('flipped')">
                    <div class="card-inner">
                        <div class="card-front bg-white border-2 border-pink-100">
                            <div id="fc-word" class="text-5xl font-bold text-gray-800 kanji-font"></div>
                            <div id="fc-reading" class="text-xl text-pink-500 mt-2"></div>
                        </div>
                        <div class="card-back bg-pink-50">
                            <div id="fc-meaning" class="text-2xl font-bold text-gray-800 px-6"></div>
                        </div>
                    </div>
                </div>
                
                <div id="ai-vocab-box" class="hidden w-full bg-white p-4 rounded-xl border border-pink-200 shadow-sm">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-pink-500">‚ú® AI Sensei:</span>
                        <div id="ai-vocab-loading" class="spinner hidden"></div>
                    </div>
                    <p id="ai-vocab-content" class="text-sm text-gray-700 leading-relaxed italic"></p>
                </div>

                <div class="flex gap-4">
                    <button onclick="app.prevCard()" class="p-3 rounded-full bg-white shadow-md">‚óÄ</button>
                    <button onclick="app.nextCard()" class="p-3 rounded-full bg-pink-500 text-white shadow-md">‚ñ∂</button>
                </div>
            </div>
        </section>

        <!-- GRAMMAR -->
        <section id="tab-grammar" class="tab-content p-4 max-w-3xl mx-auto">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Ng·ªØ Ph√°p N4</h2>
            <div id="grammar-list" class="space-y-4">
                <!-- Grammar items dynamic -->
            </div>
        </section>

        <!-- AI SENSEI (CHAT) -->
        <section id="tab-sensei" class="tab-content p-4 max-w-3xl mx-auto flex flex-col h-[calc(100vh-140px)]">
            <div class="bg-white p-4 rounded-t-2xl border-b border-gray-100 flex items-center justify-between">
                <div>
                    <h2 class="font-bold text-pink-700">Gemini Sensei ‚ú®</h2>
                    <p class="text-[10px] text-gray-500">H√£y th·ª±c h√†nh ti·∫øng Nh·∫≠t b·∫±ng c√°ch n√≥i v·ªÅ "K·∫ø ho·∫°ch ng√†y mai"!</p>
                </div>
                <button onclick="app.clearChat()" class="text-xs text-gray-400">X√≥a h·ªôi tho·∫°i</button>
            </div>
            
            <div id="chat-container" class="flex-1 bg-white overflow-y-auto p-4 space-y-4">
                <div class="bg-gray-100 p-3 rounded-lg text-sm max-w-[80%]">Ch√†o b·∫°n! T√¥i l√† gi√°o vi√™n AI. B·∫°n h√£y d√πng c√°c c·∫•u tr√∫c N4 nh∆∞ "~„Åß„Åó„Çá„ÅÜ" hay "~„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì" ƒë·ªÉ n√≥i v·ªÅ th·ªùi ti·∫øt ho·∫∑c k·∫ø ho·∫°ch ng√†y mai nh√©!</div>
            </div>

            <div class="p-4 bg-white rounded-b-2xl border-t border-gray-100 flex gap-2">
                <input id="chat-input" type="text" placeholder="Nh·∫≠p ti·∫øng Nh·∫≠t ho·∫∑c Vi·ªát..." class="flex-1 border rounded-full px-4 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400">
                <button onclick="app.sendMessage()" id="btn-send" class="bg-pink-500 text-white p-2 rounded-full w-10 h-10 flex items-center justify-center font-bold">‚ú®</button>
            </div>
        </section>

        <!-- READING -->
        <section id="tab-reading" class="tab-content p-4 max-w-3xl mx-auto">
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-4">
                <div class="flex justify-between items-start mb-4">
                    <h2 class="text-xl font-bold text-teal-700">B√†i ƒê·ªçc Hi·ªÉu</h2>
                    <button onclick="app.aiCreateQuiz()" id="btn-quiz-ai" class="bg-teal-50 text-teal-700 px-3 py-1 rounded-full text-xs font-bold border border-teal-200">‚ú® T·∫°o Quiz T·ª± ƒê·ªông</button>
                </div>
                <div id="reading-text" class="leading-loose text-lg kanji-font text-gray-800 mb-6">
                    <!-- Text in JS -->
                </div>
                
                <div id="ai-quiz-container" class="hidden border-t pt-4 space-y-4">
                    <h4 class="font-bold text-gray-700">C√¢u h·ªèi t·ª´ AI Sensei:</h4>
                    <div id="ai-quiz-content" class="text-sm space-y-3"></div>
                </div>
            </div>
        </section>

    </main>

    <!-- Navigation -->
    <nav class="bg-white border-t border-gray-200 flex justify-around py-2 sticky bottom-0 w-full z-20">
        <button onclick="app.switchTab('plan')" class="nav-item active flex flex-col items-center p-2 text-gray-400 w-1/5">
            <span class="text-xl">üìÖ</span><span class="text-[10px]">L·ªô tr√¨nh</span>
        </button>
        <button onclick="app.switchTab('vocab')" class="nav-item flex flex-col items-center p-2 text-gray-400 w-1/5">
            <span class="text-xl">„ÅÇ</span><span class="text-[10px]">T·ª´ v·ª±ng</span>
        </button>
        <button onclick="app.switchTab('grammar')" class="nav-item flex flex-col items-center p-2 text-gray-400 w-1/5">
            <span class="text-xl">Êñá</span><span class="text-[10px]">Ng·ªØ ph√°p</span>
        </button>
        <button onclick="app.switchTab('sensei')" class="nav-item flex flex-col items-center p-2 text-gray-400 w-1/5">
            <span class="text-xl">‚ú®</span><span class="text-[10px]">Sensei</span>
        </button>
        <button onclick="app.switchTab('reading')" class="nav-item flex flex-col items-center p-2 text-gray-400 w-1/5">
            <span class="text-xl">Ë™≠</span><span class="text-[10px]">ƒê·ªçc</span>
        </button>
    </nav>

    <script>
        // --- API CONFIG ---
        const apiKey = ""; // Runtime provides key
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'n4-master-ai';

        const database = {
            vocab: [
                { word: 'Âè∞È¢®', reading: '„Åü„ÅÑ„Åµ„ÅÜ', mean: 'c∆°n b√£o' },
                { word: 'Êú¨Áâ©', reading: '„Åª„Çì„ÇÇ„ÅÆ', mean: 'h√†ng th·∫≠t' },
                { word: 'ÊÑüÂãï', reading: '„Åã„Çì„Å©„ÅÜ', mean: 'c·∫£m ƒë·ªông' },
                { word: 'ÈÅäÂúíÂú∞', reading: '„ÇÜ„ÅÜ„Åà„Çì„Å°', mean: 'khu vui ch∆°i' }
            ],
            grammar: [
                { title: 'ÔΩû„Åß„Åó„Çá„ÅÜ', usage: 'Ph√°n ƒëo√°n', detail: 'S·ª≠ d·ª•ng khi ph√°n ƒëo√°n ƒëi·ªÅu g√¨ ƒë√≥ v·ªõi ƒë·ªô tin c·∫≠y cao.' },
                { title: 'ÔΩû„Åã„ÇÇ„Åó„Çå„Å™„ÅÑ', usage: 'C√≥ l·∫Ω', detail: 'Di·ªÖn t·∫£ kh·∫£ nƒÉng x·∫£y ra kho·∫£ng 50%.' }
            ],
            reading: "ÊòéÊó•„ÅØÊó•ÊõúÊó•„Åß„Åô„ÄÇÂ§©Ê∞ó‰∫àÂ†±„Å´„Çà„Çã„Å®„ÄÅÂçàÂæå„Åã„ÇâÂè∞È¢®„ÅåÊù•„Çã„Åß„Åó„Çá„ÅÜ„ÄÇ„Åß„Åô„Åã„Çâ„ÄÅÁßÅ„ÅØÂÆ∂„Åß„ÇÜ„Å£„Åè„ÇäÈÅé„Åî„Åô„Å§„ÇÇ„Çä„Åß„Åô„ÄÇ"
        };

        const app = {
            state: {
                currentTab: 'plan',
                vocabIndex: 0,
                chatHistory: []
            },

            init() {
                this.renderVocab();
                this.renderGrammar();
                this.renderChart();
                document.getElementById('reading-text').innerHTML = database.reading;
            },

            switchTab(tabId) {
                document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
                document.getElementById(`tab-${tabId}`).classList.add('active');
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                event.currentTarget.classList.add('active');
            },

            // --- AI FEATURES ---
            async callGemini(prompt, systemPrompt = "B·∫°n l√† gi√°o vi√™n ti·∫øng Nh·∫≠t N4 t·∫≠n t√¢m.") {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                let retries = 0;
                const delays = [1000, 2000, 4000, 8000, 16000];

                while (retries < 5) {
                    try {
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: prompt }] }],
                                systemInstruction: { parts: [{ text: systemPrompt }] }
                            })
                        });
                        const data = await response.json();
                        return data.candidates?.[0]?.content?.parts?.[0]?.text || "Xin l·ªói, AI ƒëang b·∫≠n.";
                    } catch (e) {
                        retries++;
                        if (retries === 5) return "L·ªói k·∫øt n·ªëi AI.";
                        await new Promise(r => setTimeout(r, delays[retries-1]));
                    }
                }
            },

            async aiExplainVocab() {
                const word = database.vocab[this.state.vocabIndex];
                const box = document.getElementById('ai-vocab-box');
                const content = document.getElementById('ai-vocab-content');
                const loader = document.getElementById('ai-vocab-loading');
                
                box.classList.remove('hidden');
                loader.classList.remove('hidden');
                content.textContent = "ƒêang ph√¢n t√≠ch...";

                const prompt = `Gi·∫£i th√≠ch t·ª´ v·ª±ng "${word.word}" (${word.reading}) tr√¨nh ƒë·ªô N4. Cho 1 v√≠ d·ª• th·ª±c t·∫ø ng·∫Øn g·ªçn b·∫±ng ti·∫øng Nh·∫≠t k√®m d·ªãch ti·∫øng Vi·ªát.`;
                const result = await this.callGemini(prompt);
                
                content.textContent = result;
                loader.classList.add('hidden');
            },

            async sendMessage() {
                const input = document.getElementById('chat-input');
                const text = input.value.trim();
                if (!text) return;

                this.addChatMessage('user', text);
                input.value = "";

                const system = "B·∫°n l√† Sensei ti·∫øng Nh·∫≠t. H√£y tr·∫£ l·ªùi b·∫±ng ti·∫øng Nh·∫≠t ƒë∆°n gi·∫£n (N4) k√®m d·ªãch ti·∫øng Vi·ªát. Khuy·∫øn kh√≠ch h·ªçc vi√™n d√πng c·∫•u tr√∫c deshou, kamoshirenai, tsumori.";
                const response = await this.callGemini(text, system);
                this.addChatMessage('ai', response);
            },

            addChatMessage(role, text) {
                const container = document.getElementById('chat-container');
                const div = document.createElement('div');
                div.className = role === 'user' 
                    ? "bg-pink-500 text-white p-3 rounded-lg text-sm self-end ml-auto max-w-[80%]" 
                    : "bg-gray-100 text-gray-800 p-3 rounded-lg text-sm max-w-[80%]";
                div.textContent = text;
                container.appendChild(div);
                container.scrollTop = container.scrollHeight;
            },

            async aiCreateQuiz() {
                const container = document.getElementById('ai-quiz-container');
                const content = document.getElementById('ai-quiz-content');
                container.classList.remove('hidden');
                content.innerHTML = "<div class='spinner'></div> ƒêang t·∫°o c√¢u h·ªèi...";

                const prompt = `D·ª±a tr√™n b√†i ƒë·ªçc n√†y: "${database.reading}", h√£y t·∫°o 2 c√¢u h·ªèi tr·∫Øc nghi·ªám ti·∫øng Vi·ªát ƒë·ªÉ ki·ªÉm tra hi·ªÉu b√†i.`;
                const result = await this.callGemini(prompt);
                content.innerHTML = `<div class='bg-teal-50 p-3 rounded border border-teal-100'>${result.replace(/\n/g, '<br>')}</div>`;
            },

            async aiGenerateMotivation() {
                const btn = document.getElementById('btn-motivation');
                btn.textContent = "‚ú® ƒêang nghƒ©...";
                const result = await this.callGemini("H√£y cho t√¥i 1 l·ªùi khuy√™n ng·∫Øn g·ªçn, h√†i h∆∞·ªõc v√† truy·ªÅn c·∫£m h·ª©ng ƒë·ªÉ h·ªçc ti·∫øng Nh·∫≠t N4 h√¥m nay.");
                alert("‚ú® L·ªùi khuy√™n t·ª´ AI Sensei:\n\n" + result);
                btn.textContent = "‚ú® Nh·∫≠n l·ªùi khuy√™n";
            },

            // --- UI RENDERING ---
            renderVocab() {
                const v = database.vocab[this.state.vocabIndex];
                document.getElementById('fc-word').textContent = v.word;
                document.getElementById('fc-reading').textContent = v.reading;
                document.getElementById('fc-meaning').textContent = v.mean;
                document.getElementById('ai-vocab-box').classList.add('hidden');
            },

            nextCard() {
                this.state.vocabIndex = (this.state.vocabIndex + 1) % database.vocab.length;
                this.renderVocab();
            },

            prevCard() {
                this.state.vocabIndex = (this.state.vocabIndex - 1 + database.vocab.length) % database.vocab.length;
                this.renderVocab();
            },

            renderGrammar() {
                const list = document.getElementById('grammar-list');
                database.grammar.forEach(g => {
                    const div = document.createElement('div');
                    div.className = "bg-white p-4 rounded-xl shadow-sm border border-gray-100";
                    div.innerHTML = `
                        <div class="flex justify-between items-center">
                            <h3 class="font-bold text-pink-700">${g.title}</h3>
                            <button onclick="app.aiExplainGrammar('${g.title}')" class="text-[10px] bg-pink-50 text-pink-600 px-2 py-1 rounded">‚ú® Gi·∫£i th√≠ch AI</button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">${g.usage}</p>
                    `;
                    list.appendChild(div);
                });
            },

            async aiExplainGrammar(title) {
                const result = await this.callGemini(`Gi·∫£i th√≠ch c·∫•u tr√∫c ng·ªØ ph√°p N4 "${title}" m·ªôt c√°ch d·ªÖ hi·ªÉu nh·∫•t cho ng∆∞·ªùi Vi·ªát, k√®m v√≠ d·ª•.`);
                alert(`‚ú® AI Gi·∫£i th√≠ch (${title}):\n\n${result}`);
            },

            renderChart() {
                const ctx = document.getElementById('progressChart').getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Ho√†n th√†nh', 'C√≤n l·∫°i'],
                        datasets: [{
                            data: [35, 65],
                            backgroundColor: ['#ec4899', '#f3f4f6'],
                            borderWidth: 0
                        }]
                    },
                    options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
                });
            },

            clearChat() {
                document.getElementById('chat-container').innerHTML = '<div class="bg-gray-100 p-3 rounded-lg text-sm max-w-[80%]">H·ªôi tho·∫°i ƒë√£ ƒë∆∞·ª£c l√†m m·ªõi. H√£y b·∫Øt ƒë·∫ßu n√≥i chuy·ªán n√†o!</div>';
            }
        };

        window.onload = () => app.init();
    </script>
</body>
</html>
